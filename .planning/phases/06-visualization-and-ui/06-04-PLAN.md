---
phase: 06-visualization-and-ui
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - Metrics/HTMLGenerator.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Scatter plot visually distinguishes invalid implementations with dashed red stroke"
    - "Heatmap cells for invalid languages have red border highlighting"
  artifacts:
    - path: "Metrics/HTMLGenerator.ts"
      provides: "Chart validation styling integration"
      contains: "hasValidationIssues"
    - path: "index.html"
      provides: "Generated report with validation-styled charts"
  key_links:
    - from: "drawScatterPlot()"
      to: "hasValidationIssues()"
      via: "class assignment"
      pattern: "hasValidationIssues.*d\\.solver"
    - from: "drawHeatmap()"
      to: "hasValidationIssues()"
      via: "stroke styling"
      pattern: "hasValidationIssues.*d\\.language"
---

<objective>
Wire validation styling to scatter plot and heatmap chart drawing functions

Purpose: Close the gap where validation infrastructure exists (CSS classes, helper function) but charts don't use it to visually distinguish invalid implementations.

Output: Updated HTMLGenerator.ts with validation-aware chart rendering in drawScatterPlot() and drawHeatmap() functions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-visualization-and-ui/06-VERIFICATION.md

# Prior summaries for context
@.planning/phases/06-visualization-and-ui/06-02-SUMMARY.md
@.planning/phases/06-visualization-and-ui/06-03-SUMMARY.md

# Source files to modify
@Metrics/HTMLGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add validation class to scatter plot points</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
In the inline JavaScript within HTMLGenerator.ts, locate the drawScatterPlot() function's point class assignment (around the scatter point creation code).

Find this pattern:
```javascript
.attr("class", d => {
    let classes = "scatter-point";
    if (outlierNames.has(d.solver)) classes += " outlier";
    return classes;
})
```

Update to include validation check:
```javascript
.attr("class", d => {
    let classes = "scatter-point";
    if (outlierNames.has(d.solver)) classes += " outlier";
    if (window.hasValidationIssues && window.hasValidationIssues(d.solver)) classes += " invalid";
    return classes;
})
```

The guard `window.hasValidationIssues &&` ensures backward compatibility if the helper isn't defined.

The CSS class `.scatter-point.invalid` already exists in SharedStyles.ts with:
- stroke: #ff4444
- stroke-width: 2
- stroke-dasharray: 2,2
  </action>
  <verify>
Run report generation and inspect the generated index.html:
```bash
cd Metrics && npx ts-node generate_report_only.ts
grep -A5 "scatter-point" ../index.html | grep -i "hasValidationIssues"
```
Should show the validation check in the class attribute assignment.
  </verify>
  <done>Scatter plot points with validation issues have `invalid` class applied, showing dashed red stroke.</done>
</task>

<task type="auto">
  <name>Task 2: Add validation styling to heatmap cells</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
In the inline JavaScript within HTMLGenerator.ts, locate the drawHeatmap() function's cell drawing code.

Find the cell creation chain (selectAll(".heatmap-cell")...append("rect")...) and add stroke styling after the fill attribute:

Before:
```javascript
.attr("fill", d => colorScale(d.time))
.on("mouseover", function () {
```

After:
```javascript
.attr("fill", d => colorScale(d.time))
.style("stroke", d => window.hasValidationIssues && window.hasValidationIssues(d.language) ? '#ff4444' : '#2a2a35')
.style("stroke-width", d => window.hasValidationIssues && window.hasValidationIssues(d.language) ? '2' : '1')
.on("mouseover", function () {
```

This gives invalid language cells a red border while normal cells retain the subtle dark stroke.

Note: The heatmap data uses `d.language` not `d.solver` - the data structure maps language names.
  </action>
  <verify>
Run report generation and inspect the generated index.html:
```bash
cd Metrics && npx ts-node generate_report_only.ts
grep -B5 -A10 "heatmap-cell" ../index.html | grep -i "hasValidationIssues"
```
Should show the validation check in the stroke style assignments.
  </verify>
  <done>Heatmap cells for languages with validation issues have red border (#ff4444) with stroke-width 2.</done>
</task>

<task type="auto">
  <name>Task 3: Regenerate report and verify visual integration</name>
  <files>index.html</files>
  <action>
Regenerate the HTML report to apply the changes:
```bash
cd Metrics && npx ts-node generate_report_only.ts
```

Verify the integration by checking:
1. The scatter plot code includes hasValidationIssues check
2. The heatmap code includes stroke styling with validation check
3. No JavaScript errors in the generated code

The benchmark_issues.json already has test data (TestLang with 3 issues from 06-03). If TestLang metrics exist, its scatter point and heatmap cells should show red styling.

Note: If no languages in the actual metrics have validation issues, the styling won't visually appear but the code path is correct. This is expected - validation issues indicate broken implementations.
  </action>
  <verify>
Visual verification in browser:
1. Open index.html in browser
2. Select "Time vs Memory" scatter plot
3. Select "Heatmap" chart
4. If any language has validation issues, it should have red dashed stroke (scatter) or red border (heatmap)

Code verification:
```bash
grep -c "hasValidationIssues" index.html
```
Should return 4+ occurrences (helper definition + scatter + heatmap usages).
  </verify>
  <done>Generated report includes validation-styled scatter plot and heatmap charts. Visual distinction works for any language with validation issues.</done>
</task>

</tasks>

<verification>
Phase gap closure verification:
1. drawScatterPlot() applies 'invalid' class via hasValidationIssues() check
2. drawHeatmap() applies red stroke via hasValidationIssues() check
3. Generated index.html contains validation-aware chart code
4. CSS class .scatter-point.invalid renders correctly (pre-existing from 06-03)
</verification>

<success_criteria>
- Scatter plot points for invalid implementations have dashed red stroke
- Heatmap cells for invalid implementations have red border
- No JavaScript errors in generated report
- Validation styling integrates cleanly with existing chart code
- Phase 6 verification gap closed: "Invalid implementations visually distinguished in charts"
</success_criteria>

<output>
After completion, create `.planning/phases/06-visualization-and-ui/06-04-SUMMARY.md`
</output>
