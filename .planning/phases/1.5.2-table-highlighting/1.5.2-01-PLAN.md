---
phase: 1.5.2-table-highlighting
plan: 01
type: execute
---

<objective>
Fix table hover text shift and implement expandable row infrastructure.

Purpose: Eliminate layout shift on hover and add clickable row expansion with chevron indicator for detailed metrics display.
Output: Clean hover effects without text shift, expandable rows with organized content sections showing existing metrics data.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/1.5.2-table-highlighting/1.5.2-CONTEXT.md

**Relevant source files:**
@Metrics/index.css
@Metrics/HTMLGenerator.ts
@Metrics/report_client.js

**Key issues identified:**
- `index.css:67-74`: `tr:hover td` has `transform: scale(1.01)` causing layout shift
- `index.css:76-81`: `td:hover` adds border without transparent default, causing size change
- No chevron indicator for expandable rows
- No expand/collapse functionality

**Solution approach (from CONTEXT.md):**
- Use transparent borders in default state, colored on hover
- Remove scale transform entirely
- Add chevron icon (▶) that rotates to (▼) when expanded
- Expanded content shows three sections: System | Compilation | Results
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix CSS hover effects</name>
  <files>Metrics/index.css</files>
  <action>
    Fix the hover text shift by:
    1. Remove `transform: scale(1.01)` from `tr:hover td` rule (line ~70) - this is the primary cause of layout shift
    2. Add transparent border to default `td` rule: `border: 1px solid transparent`
    3. Update `td:hover` to change border color only (not add new border): `border-color: var(--primary)`
    4. Keep the background-color changes and box-shadow effects for visual feedback
    5. Remove `position: relative` and `z-index` from hover states (not needed without scale)

    The goal is smooth visual feedback without any element size changes.
  </action>
  <verify>
    Open benchmark_history.html in browser, hover over table rows - text should NOT shift or move. Only colors and shadows should change.
  </verify>
  <done>Hovering over rows produces visual feedback (color, shadow) without any text movement or layout shift</done>
</task>

<task type="auto">
  <name>Task 2: Add chevron indicator and expand/collapse handler</name>
  <files>Metrics/HTMLGenerator.ts, Metrics/report_client.js, Metrics/index.css</files>
  <action>
    1. In HTMLGenerator.ts, modify the language column (`lang-col`) to include a chevron:
       - Add chevron span before logo: `<span class="expand-chevron">▶</span>`
       - The chevron should be inline with the logo and language name

    2. In index.css, add chevron styling:
       ```css
       .expand-chevron {
           display: inline-block;
           margin-right: 8px;
           transition: transform 0.15s ease;
           color: var(--muted);
           font-size: 0.8em;
       }
       tr.expanded .expand-chevron {
           transform: rotate(90deg);
           color: var(--primary);
       }
       ```

    3. In report_client.js, add click handler for row expansion:
       - Find where table row click handlers are set up (or add new one)
       - On row click (not on existing interactive elements like buttons):
         - Toggle 'expanded' class on the clicked tr
         - Show/hide the expanded content row (next sibling or injected row)
       - Prevent expansion when clicking run buttons or other interactive elements

    4. The expand should NOT use animations (instant show/hide per CONTEXT.md boundaries)
  </action>
  <verify>
    Click on a table row - chevron should rotate from ▶ to ▼ (90 degrees), row should get 'expanded' class. Click again to toggle back.
  </verify>
  <done>Chevron indicator visible on all rows, clicking row toggles expanded state, chevron rotates to indicate state</done>
</task>

<task type="auto">
  <name>Task 3: Build expanded row content structure</name>
  <files>Metrics/HTMLGenerator.ts, Metrics/report_client.js, Metrics/index.css</files>
  <action>
    1. In HTMLGenerator.ts, after each data row, add a hidden expanded content row:
       ```html
       <tr class="expanded-content" style="display: none;">
         <td colspan="[total columns]">
           <div class="expanded-sections">
             <div class="expanded-section">
               <div class="section-title">System</div>
               <div class="section-content">OS: - | CPU: - | RAM: - | Arch: -</div>
             </div>
             <div class="expanded-section">
               <div class="section-title">Compilation</div>
               <div class="section-content">Compiler: [from metadata] | Flags: - | Level: -</div>
             </div>
             <div class="expanded-section">
               <div class="section-title">Matrix Results</div>
               <div class="section-content">
                 [For each matrix with data: M1: 0.001s, 656 iter, 1.2MB | ...]
               </div>
             </div>
           </div>
         </td>
       </tr>
       ```

    2. Use existing data from metrics for Matrix Results section:
       - Time from each matrix result
       - Iterations from each matrix result
       - Memory from each matrix result

    3. For System and Compilation, show placeholder or pull from languageMetadata if available

    4. In report_client.js, update the expand/collapse handler to toggle the next sibling row (.expanded-content):
       ```javascript
       // When expanding: nextElementSibling.style.display = 'table-row'
       // When collapsing: nextElementSibling.style.display = 'none'
       ```

    5. In index.css, add expanded content styling:
       ```css
       .expanded-content {
           background: var(--surface);
       }
       .expanded-content td {
           padding: 0;
           border: none;
       }
       .expanded-sections {
           display: flex;
           gap: 20px;
           padding: 15px 20px;
           background: #12121a;
           border-left: 3px solid var(--primary);
           margin: 5px 0;
       }
       .expanded-section {
           flex: 1;
           padding: 10px;
       }
       .section-title {
           color: var(--secondary);
           font-size: 0.9em;
           text-transform: uppercase;
           margin-bottom: 8px;
           border-bottom: 1px solid var(--border);
           padding-bottom: 5px;
       }
       .section-content {
           color: var(--text);
           font-size: 0.85em;
           line-height: 1.6;
       }
       ```
  </action>
  <verify>
    1. Click row to expand - three sections should appear (System, Compilation, Matrix Results)
    2. Matrix Results section should show actual data from metrics (times, iterations, memory)
    3. Click again to collapse - content should hide instantly
    4. Visual styling matches dark theme with cyan/green accents
  </verify>
  <done>Expanded rows show three organized sections with real metrics data, styling consistent with theme, instant expand/collapse</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Hover over any table row - NO text shift or movement
- [ ] Chevron visible on all language rows
- [ ] Click row - chevron rotates, expanded content appears instantly
- [ ] Expanded content shows System, Compilation, Matrix Results sections
- [ ] Matrix Results populated with real data (times, iterations, memory)
- [ ] Click again - content collapses instantly
- [ ] No console errors in browser
- [ ] `npm run build` in Metrics/ succeeds (if applicable)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Hover effects produce visual feedback without layout shift
- Expandable rows functional with chevron indicator
- Expanded content displays organized metrics data
- No regressions to existing table functionality
</success_criteria>

<output>
After completion, create `.planning/phases/1.5.2-table-highlighting/1.5.2-01-SUMMARY.md`:

# Phase 1.5.2 Plan 01: CSS Fix + Expandable Infrastructure Summary

**[Substantive one-liner describing what was accomplished]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]
- [Key outcome 3]

## Files Created/Modified
- `Metrics/index.css` - [Description of changes]
- `Metrics/HTMLGenerator.ts` - [Description of changes]
- `Metrics/report_client.js` - [Description of changes]

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 1.5.2-02-PLAN.md (Enhanced Table Columns)
</output>
