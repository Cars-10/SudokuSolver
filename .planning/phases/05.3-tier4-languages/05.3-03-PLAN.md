---
phase: 05.3-tier4-languages
plan: 03
type: execute
---

<objective>
Implement V and Vala Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add modern compiled languages (V for simplicity, Vala for GNOME ecosystem) to Tier 4 benchmark
Output: Working V and Vala solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Existing code directories:**
@Languages/Vala/

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**
- V: Simple, fast-compiling systems language. C-like syntax but cleaner. No hidden allocations.
- Vala: GNOME language that compiles to C via GObject. C#-like syntax with GLib types.
- Both are compiled, expect fast execution similar to C/C++

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add V and Vala to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add V language section:
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 38. V Language
       # ----------------------------------------------------------------------------
       RUN ARCH=$(dpkg --print-architecture) \
           && V_VERSION=weekly.2024.12.08 \
           && if [ "$ARCH" = "arm64" ]; then V_ARCH="linux_arm64"; else V_ARCH="linux_amd64"; fi \
           && wget -q https://github.com/vlang/v/releases/download/${V_VERSION}/v_${V_ARCH}.zip \
           && unzip -q v_${V_ARCH}.zip -d /usr/local \
           && ln -s /usr/local/v/v /usr/local/bin/v \
           && rm v_${V_ARCH}.zip
       # v --version: V 0.4.x
       ```

    2. Add Vala section:
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 39. Vala
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           valac \
           libglib2.0-dev \
           && rm -rf /var/lib/apt/lists/*
       # valac --version: 0.56.x
       ```

    3. Rebuild Docker image:
       docker-compose build --no-cache app
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "v --version && valac --version"
  </verify>
  <done>V and Vala toolchains available in Docker</done>
</task>

<task type="auto">
  <name>Task 2: Implement V solver</name>
  <files>Languages/V/Sudoku.v, Languages/V/runMe.sh, Languages/V/README.md</files>
  <action>
    1. Create Languages/V/ directory if needed

    2. Create Sudoku.v matching C algorithm:
       ```v
       import os
       import time

       mut puzzle := [9][9]int{}
       mut count := 0

       fn is_valid(row int, col int, val int) bool {
           // Check row
           for i in 0..9 {
               if puzzle[row][i] == val { return false }
           }
           // Check column
           for i in 0..9 {
               if puzzle[i][col] == val { return false }
           }
           // Check 3x3 box
           br := (row / 3) * 3
           bc := (col / 3) * 3
           for i in 0..3 {
               for j in 0..3 {
                   if puzzle[br + i][bc + j] == val { return false }
               }
           }
           return true
       }

       fn solve() bool {
           for row in 0..9 {
               for col in 0..9 {
                   if puzzle[row][col] == 0 {
                       for val in 1..10 {
                           count++  // COUNT BEFORE validity check
                           if is_valid(row, col, val) {
                               puzzle[row][col] = val
                               if solve() { return true }
                               puzzle[row][col] = 0
                           }
                       }
                       return false
                   }
               }
           }
           return true
       }

       fn main() {
           // Read matrix file from args
           // Output in C format
       }
       ```

    3. Handle file I/O and output format

    4. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="V"
       source ../common.sh

       get_compile_flags() {
           echo "-prod"
       }

       compile_source() {
           v -prod -o Sudoku Sudoku.v
       }

       compile_source
       run_benchmark "./Sudoku"
       ```

    5. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/V && v -prod -o Sudoku Sudoku.v && ./Sudoku /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>V solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 3: Implement Vala solver</name>
  <files>Languages/Vala/Sudoku.vala, Languages/Vala/runMe.sh, Languages/Vala/README.md</files>
  <action>
    1. Create Sudoku.vala matching C algorithm:
       ```vala
       public class Sudoku {
           private int[,] puzzle = new int[9,9];
           private int count = 0;

           public bool is_valid(int row, int col, int val) {
               // Check row
               for (int i = 0; i < 9; i++) {
                   if (puzzle[row,i] == val) return false;
               }
               // Check column
               for (int i = 0; i < 9; i++) {
                   if (puzzle[i,col] == val) return false;
               }
               // Check 3x3 box
               int br = (row / 3) * 3;
               int bc = (col / 3) * 3;
               for (int i = 0; i < 3; i++) {
                   for (int j = 0; j < 3; j++) {
                       if (puzzle[br+i,bc+j] == val) return false;
                   }
               }
               return true;
           }

           public bool solve() {
               for (int row = 0; row < 9; row++) {
                   for (int col = 0; col < 9; col++) {
                       if (puzzle[row,col] == 0) {
                           for (int val = 1; val <= 9; val++) {
                               count++;  // COUNT BEFORE validity check
                               if (is_valid(row, col, val)) {
                                   puzzle[row,col] = val;
                                   if (solve()) return true;
                                   puzzle[row,col] = 0;
                               }
                           }
                           return false;
                       }
                   }
               }
               return true;
           }

           public static int main(string[] args) {
               // Read matrix and solve
               return 0;
           }
       }
       ```

    2. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Vala"
       source ../common.sh

       get_compile_flags() {
           echo "-O2"
       }

       compile_source() {
           valac -O2 -o Sudoku Sudoku.vala
       }

       compile_source
       run_benchmark "./Sudoku"
       ```

    3. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Vala && valac -O2 -o Sudoku Sudoku.vala && ./Sudoku /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Vala solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 4: Validate both languages on all matrices</name>
  <files>Languages/V/metrics.json, Languages/Vala/metrics.json</files>
  <action>
    1. Run full validation for V:
       cd Languages/V && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    2. Run full validation for Vala:
       cd Languages/Vala && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    3. Verify all iteration counts match exactly

    4. Regenerate benchmark report

    5. Update README.md files with validation results
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/V/metrics.json /app/Languages/Vala/metrics.json" | grep -o '"iterations": [0-9]*' | head -10
  </verify>
  <done>Both V and Vala validated on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with V and Vala
- [ ] V solver compiles and runs with -prod flag
- [ ] Vala solver compiles with valac and links GLib
- [ ] Both match all 5 iteration counts
- [ ] Both runMe.sh scripts follow common.sh pattern with compile_source
- [ ] Both README.md files document validation status
</verification>

<success_criteria>
- V and Vala fully validated on all 5 matrices
- Both demonstrate modern compiled language performance
- 45 languages total passing validation
</success_criteria>

<output>
After completion, create `.planning/phases/05.3-tier4-languages/05.3-03-SUMMARY.md`
</output>
