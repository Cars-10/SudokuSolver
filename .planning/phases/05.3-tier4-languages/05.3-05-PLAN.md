---
phase: 05.3-tier4-languages
plan: 05
type: execute
---

<objective>
Implement Haxe and Rexx Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add cross-platform compiler (Haxe) and IBM legacy scripting (Rexx) to Tier 4 benchmark
Output: Working Haxe and Rexx solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Existing code directories:**
@Languages/Haxe/
@Languages/Rexx/

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**
- Haxe: Multi-target compiler (JS, C++, Java, C#, Python, PHP, Lua). ActionScript heritage. Strong typing.
- Rexx (Regina): IBM scripting language from 1979. Human-readable syntax. Used in mainframes and OS/2.
- Haxe compiles to multiple targets; we'll use HashLink or C++ target for performance
- Rexx is interpreted, expect slower performance

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Haxe and Rexx to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add Haxe section (with HashLink runtime):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 42. Haxe (with HashLink runtime)
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           haxe \
           && rm -rf /var/lib/apt/lists/* \
           && haxelib setup /usr/share/haxe/lib \
           && haxelib install hashlink

       # Install HashLink (HL) runtime for native execution
       RUN apt-get update && apt-get install -y \
           libpng-dev libturbojpeg0-dev libvorbis-dev libopenal-dev libsdl2-dev libmbedtls-dev libuv1-dev \
           && rm -rf /var/lib/apt/lists/* \
           && ARCH=$(dpkg --print-architecture) \
           && if [ "$ARCH" != "arm64" ]; then \
                git clone https://github.com/HaxeFoundation/hashlink.git /tmp/hashlink \
                && cd /tmp/hashlink \
                && make \
                && make install \
                && rm -rf /tmp/hashlink; \
              fi
       # haxe --version: 4.x.x
       ```

    2. Add Regina Rexx section:
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 43. Regina Rexx
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           regina-rexx \
           && rm -rf /var/lib/apt/lists/*
       # regina --version: 3.x.x
       ```

    3. Rebuild Docker image:
       docker-compose build --no-cache app
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "haxe --version && regina --version 2>&1 | head -1"
  </verify>
  <done>Haxe and Rexx toolchains available in Docker</done>
</task>

<task type="auto">
  <name>Task 2: Implement Haxe solver</name>
  <files>Languages/Haxe/Sudoku.hx, Languages/Haxe/compile.hxml, Languages/Haxe/runMe.sh, Languages/Haxe/README.md</files>
  <action>
    1. Create Sudoku.hx matching C algorithm:
       ```haxe
       import sys.io.File;
       import Sys;

       class Sudoku {
           var puzzle:Array<Array<Int>>;
           var count:Int = 0;

           public function new() {
               puzzle = [for (i in 0...9) [for (j in 0...9) 0]];
           }

           function isValid(row:Int, col:Int, val:Int):Bool {
               // Check row
               for (i in 0...9) {
                   if (puzzle[row][i] == val) return false;
               }
               // Check column
               for (i in 0...9) {
                   if (puzzle[i][col] == val) return false;
               }
               // Check 3x3 box
               var br = Std.int(row / 3) * 3;
               var bc = Std.int(col / 3) * 3;
               for (i in 0...3) {
                   for (j in 0...3) {
                       if (puzzle[br + i][bc + j] == val) return false;
                   }
               }
               return true;
           }

           function solve():Bool {
               for (row in 0...9) {
                   for (col in 0...9) {
                       if (puzzle[row][col] == 0) {
                           for (val in 1...10) {
                               count++;  // COUNT BEFORE validity check
                               if (isValid(row, col, val)) {
                                   puzzle[row][col] = val;
                                   if (solve()) return true;
                                   puzzle[row][col] = 0;
                               }
                           }
                           return false;
                       }
                   }
               }
               return true;
           }

           public function readMatrix(filename:String):Void {
               // Read file and parse puzzle
           }

           public function printPuzzle():Void {
               Sys.println("\nPuzzle:");
               for (row in puzzle) {
                   Sys.println(row.map(v -> Std.string(v)).join(" "));
               }
           }

           static function main() {
               var args = Sys.args();
               if (args.length < 1) {
                   Sys.println("Usage: Sudoku <input_file>");
                   return;
               }
               var solver = new Sudoku();
               solver.readMatrix(args[0]);
               solver.solve();
               solver.printPuzzle();
               Sys.println('\nSolved in Iterations=${solver.count}\n');
           }
       }
       ```

    2. Create compile.hxml for interp target (simplest):
       ```hxml
       -main Sudoku
       --interp
       ```

    3. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Haxe"
       source ../common.sh
       run_benchmark "haxe --run Sudoku"
       ```

    4. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Haxe && haxe --run Sudoku /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Haxe solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 3: Implement Rexx solver</name>
  <files>Languages/Rexx/Sudoku.rexx, Languages/Rexx/runMe.sh, Languages/Rexx/README.md</files>
  <action>
    1. Create Sudoku.rexx matching C algorithm:
       ```rexx
       #!/usr/bin/env regina
       /* Sudoku solver in Regina Rexx */

       /* Initialize puzzle array and counter */
       count = 0

       /* Main program */
       parse arg filename
       if filename = '' then do
         say 'Usage: regina Sudoku.rexx <input_file>'
         exit 1
       end

       call readMatrix filename
       call printPuzzle
       call solve
       exit 0

       /* Read matrix from file */
       readMatrix: procedure expose puzzle.
         parse arg filename
         row = 0
         do while lines(filename) > 0
           line = linein(filename)
           if left(strip(line), 1) \= '#' & strip(line) \= '' then do
             do col = 0 to 8
               puzzle.row.col = word(line, col + 1)
             end
             row = row + 1
           end
         end
         call stream filename, 'C', 'CLOSE'
         return

       /* Print puzzle */
       printPuzzle: procedure expose puzzle.
         say ''
         say 'Puzzle:'
         do row = 0 to 8
           line = ''
           do col = 0 to 8
             line = line || puzzle.row.col || ' '
           end
           say strip(line)
         end
         return

       /* Check if placing val at (row, col) is valid */
       isValid: procedure expose puzzle.
         parse arg row, col, val
         /* Check row */
         do i = 0 to 8
           if puzzle.row.i = val then return 0
         end
         /* Check column */
         do i = 0 to 8
           if puzzle.i.col = val then return 0
         end
         /* Check 3x3 box */
         br = (row % 3) * 3
         bc = (col % 3) * 3
         do i = 0 to 2
           do j = 0 to 2
             r = br + i
             c = bc + j
             if puzzle.r.c = val then return 0
           end
         end
         return 1

       /* Recursive solver */
       solve: procedure expose puzzle. count
         do row = 0 to 8
           do col = 0 to 8
             if puzzle.row.col = 0 then do
               do val = 1 to 9
                 count = count + 1  /* COUNT BEFORE validity check */
                 if isValid(row, col, val) then do
                   puzzle.row.col = val
                   if solve() then return 1
                   puzzle.row.col = 0
                 end
               end
               return 0
             end
           end
         end
         call printPuzzle
         say ''
         say 'Solved in Iterations=' || count
         say ''
         return 1
       ```

    2. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Rexx"
       source ../common.sh
       run_benchmark "regina Sudoku.rexx"
       ```

    3. Create README.md documenting IBM heritage
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Rexx && regina Sudoku.rexx /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Rexx solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 4: Validate both languages on all matrices</name>
  <files>Languages/Haxe/metrics.json, Languages/Rexx/metrics.json</files>
  <action>
    1. Run full validation for Haxe:
       cd Languages/Haxe && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    2. Run full validation for Rexx:
       cd Languages/Rexx && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    3. Verify all iteration counts match exactly

    4. Regenerate benchmark report with all 49 languages

    5. Update README.md files with validation results

    6. Update STATE.md to mark Phase 5.3 complete
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/Haxe/metrics.json /app/Languages/Rexx/metrics.json" | grep -o '"iterations": [0-9]*' | head -10
  </verify>
  <done>Both Haxe and Rexx validated on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with Haxe and Regina Rexx
- [ ] Haxe solver runs via --interp or HashLink
- [ ] Rexx solver uses Regina interpreter
- [ ] Both match all 5 iteration counts exactly
- [ ] Both runMe.sh scripts follow common.sh pattern
- [ ] README.md files document language heritage
- [ ] Benchmark report shows all 49 languages
- [ ] Phase 5.3 complete - Tier 4 done
</verification>

<success_criteria>
- Haxe and Rexx fully validated on all 5 matrices
- Cross-platform (Haxe) and legacy (Rexx) paradigms demonstrated
- 49 languages total passing validation (Tier 1+2+3+4 complete!)
- Phase 5.3 complete, ready for Phase 6 (Matrix 6 enablement)
</success_criteria>

<output>
After completion, create `.planning/phases/05.3-tier4-languages/05.3-05-SUMMARY.md`
</output>
