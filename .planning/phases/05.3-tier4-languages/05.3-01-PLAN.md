---
phase: 05.3-tier4-languages
plan: 01
type: execute
---

<objective>
Implement CoffeeScript and Racket Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add transpiled JavaScript and modern Scheme languages to the Tier 4 benchmark suite
Output: Working CoffeeScript and Racket solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Existing code to fix:**
@Languages/CoffeeScript/Sudoku.coffee
@Languages/Racket/Sudoku.rkt

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**
- CoffeeScript: Transpiles to JavaScript, runs on Node.js. Existing code has WRONG iteration counting (increments after validity check instead of before)
- Racket: Modern Scheme with batteries. Existing code has correct iteration counting but output format may not match C exactly
- Both need Docker toolchain updates

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CoffeeScript and Racket to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add CoffeeScript section after Tier 3 languages:
       ```dockerfile
       # TIER 4 LANGUAGES
       # ----------------------------------------------------------------------------
       # 34. CoffeeScript (via npm - already have Node.js)
       # ----------------------------------------------------------------------------
       RUN npm install -g coffeescript
       # coffee --version: 2.x.x

       # ----------------------------------------------------------------------------
       # 35. Racket
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           racket \
           && rm -rf /var/lib/apt/lists/*
       # racket --version: 8.x.x
       ```

    2. Update toolchain version comments at bottom of Dockerfile

    3. Rebuild Docker image:
       docker-compose build --no-cache app
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "coffee --version && racket --version"
  </verify>
  <done>CoffeeScript and Racket toolchains available in Docker</done>
</task>

<task type="auto">
  <name>Task 2: Fix CoffeeScript solver</name>
  <files>Languages/CoffeeScript/Sudoku.coffee, Languages/CoffeeScript/runMe.sh, Languages/CoffeeScript/README.md</files>
  <action>
    1. Rewrite Sudoku.coffee to match C algorithm EXACTLY:
       - count++ BEFORE isValid check (current code is WRONG)
       - Row-major traversal (row 0-8, then col 0-8)
       - Output format: "Solved in Iterations=N" (no space after =)
       - Puzzle output: space-separated digits per row

    2. Fix the solve function:
       ```coffeescript
       solve: ->
         # Find first empty cell (row-major)
         for row in [0..8]
           for col in [0..8]
             if @board[row][col] == 0
               # Try values 1-9
               for val in [1..9]
                 @iterations++  # COUNT BEFORE validity check
                 if @isValid(row, col, val)
                   @board[row][col] = val
                   if @solve()
                     return true
                   @board[row][col] = 0
               return false  # Backtrack
         return true  # Solved
       ```

    3. Fix output format to match C:
       - Print filename path first
       - Print input puzzle
       - Print "\nPuzzle:" header before solution
       - Print "Solved in Iterations=N"

    4. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="CoffeeScript"
       source ../common.sh
       # No compilation needed - coffee runs directly
       run_benchmark "coffee Sudoku.coffee"
       ```

    5. Create README.md documenting the implementation
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/CoffeeScript && coffee Sudoku.coffee /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>CoffeeScript solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 3: Validate CoffeeScript and fix Racket solver</name>
  <files>Languages/CoffeeScript/metrics.json, Languages/Racket/Sudoku.rkt, Languages/Racket/runMe.sh, Languages/Racket/README.md</files>
  <action>
    1. Validate CoffeeScript on all 5 matrices:
       - Run each matrix, verify iteration counts
       - 656, 439269, 98847, 9085, 445778

    2. Fix Racket solver output format:
       - Current code has correct iteration counting (line 77)
       - Fix output to match C format exactly:
         * Print filename path
         * Print input puzzle (space-separated)
         * Print "\nPuzzle:" before solution
         * Print "Solved in Iterations=N" format

    3. Create runMe.sh for Racket:
       ```bash
       #!/bin/bash
       LANGUAGE="Racket"
       source ../common.sh
       # No compilation needed
       run_benchmark "racket Sudoku.rkt"
       ```

    4. Create README.md for Racket
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Racket && racket Sudoku.rkt /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Racket solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 4: Validate both languages on all matrices</name>
  <files>Languages/CoffeeScript/metrics.json, Languages/Racket/metrics.json</files>
  <action>
    1. Run full validation for CoffeeScript:
       cd Languages/CoffeeScript && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    2. Run full validation for Racket:
       cd Languages/Racket && ./runMe.sh /app/Matrices/{1,2,3,4,5}.matrix

    3. Verify all iteration counts match:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    4. Regenerate benchmark report to include new languages

    5. Update both README.md files with validation results
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/CoffeeScript/metrics.json /app/Languages/Racket/metrics.json" | grep -o '"iterations": [0-9]*' | head -10
  </verify>
  <done>Both CoffeeScript and Racket validated on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with CoffeeScript and Racket
- [ ] CoffeeScript solver: iteration count++ BEFORE isValid check
- [ ] Racket solver: output format matches C exactly
- [ ] Both match all 5 iteration counts (656, 439269, 98847, 9085, 445778)
- [ ] Both runMe.sh scripts follow common.sh pattern
- [ ] Both README.md files document validation status
- [ ] Benchmark report regenerated with new languages
</verification>

<success_criteria>
- CoffeeScript and Racket fully validated on all 5 matrices
- Both use established common.sh benchmark pattern
- Documentation complete for both languages
- 41 languages total passing validation
</success_criteria>

<output>
After completion, create `.planning/phases/05.3-tier4-languages/05.3-01-SUMMARY.md`
</output>
