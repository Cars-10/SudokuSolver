---
phase: 05-scoring-analysis
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - Metrics/HTMLGenerator.ts
  - Metrics/SharedStyles.ts
autonomous: true

must_haves:
  truths:
    - "Main rankings table shows stacked bar chart (80% blue + 20% orange) next to composite score"
    - "Clicking a language row expands to show rank positions across 4 weight scenarios"
    - "Expanded row shows max rank swing value"
    - "Summary section displays top 5 most stable and top 5 most unstable languages"
    - "Summary section displays R^2 correlation with plain-English interpretation"
    - "Summary section lists statistical outliers with explanations"
    - "Stacked bar tooltips show exact breakdown on hover"
    - "Expandable rows animate smoothly (not instant show/hide)"
  artifacts:
    - path: "Metrics/HTMLGenerator.ts"
      provides: "Score decomposition visualization, expandable sensitivity rows, insights sections"
      contains: "scoringAnalysisData, generateScoreDecomposition, toggleRow"
    - path: "Metrics/SharedStyles.ts"
      provides: "CSS for stacked bars, expandable rows, insights sections"
      contains: "score-decomposition, expandable-row, scoring-insights"
  key_links:
    - from: "Metrics/HTMLGenerator.ts"
      to: "Metrics/scoring-analysis.ts"
      via: "import and call analysis functions during report generation"
      pattern: "import.*scoring-analysis"
    - from: "index.html (generated)"
      to: "scoringAnalysisData (embedded JSON)"
      via: "JavaScript uses embedded data for interactive features"
      pattern: "window\\.scoringAnalysisData"
---

<objective>
Integrate scoring analysis into the HTML report with interactive visualizations: stacked bar score decomposition, expandable sensitivity analysis rows, and summary insights sections for correlation and outliers.

Purpose: Make the 80/20 weighting transparent, show how rankings change under different weight scenarios, and provide statistical insights accessible to non-statisticians.

Output: Modified HTMLGenerator.ts with analysis integration, updated SharedStyles.ts with CSS, and generated index.html with interactive scoring insights.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase-specific context
@.planning/phases/05-scoring-analysis/05-CONTEXT.md
@.planning/phases/05-scoring-analysis/05-RESEARCH.md

# Prior plan output
@.planning/phases/05-scoring-analysis/05-01-SUMMARY.md

# Target files
@Metrics/HTMLGenerator.ts
@Metrics/SharedStyles.ts
@Metrics/scoring-analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS styles for score decomposition and expandable rows</name>
  <files>Metrics/SharedStyles.ts</files>
  <action>
Add new CSS styles to SharedStyles.ts for the scoring analysis UI components. Find the existing styles object/template and add:

```typescript
// Score Decomposition Stacked Bar Styles
const scoreDecompositionStyles = `
/* Score Decomposition - Mini Stacked Bar */
.score-decomposition {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: help;
}

.stacked-bar {
    display: flex;
    width: 60px;
    height: 16px;
    border-radius: 3px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.3);
}

.bar-segment {
    height: 100%;
    transition: opacity 0.2s ease;
}

.bar-time {
    background: linear-gradient(180deg, #4A90E2 0%, #357ABD 100%);
}

.bar-memory {
    background: linear-gradient(180deg, #F5A623 0%, #D4880F 100%);
}

.score-decomposition:hover .stacked-bar {
    transform: scale(1.1);
    box-shadow: 0 0 8px rgba(74,144,226,0.5);
}

.score-value {
    font-weight: 600;
    font-size: 14px;
    min-width: 50px;
}

/* Expandable Row Styles */
.expandable-row {
    background: rgba(0,0,0,0.2);
}

.expandable-row td {
    padding: 0 !important;
    border-top: none;
}

.sensitivity-details {
    padding: 16px 24px;
    background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
    border-left: 3px solid #4A90E2;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
}

.sensitivity-details h4 {
    margin: 0 0 12px 0;
    color: #4A90E2;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.sensitivity-table {
    width: auto;
    margin-bottom: 12px;
    border-collapse: collapse;
}

.sensitivity-table th,
.sensitivity-table td {
    padding: 6px 16px;
    text-align: left;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    font-size: 13px;
}

.sensitivity-table th {
    color: #888;
    font-weight: 500;
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 0.5px;
}

.sensitivity-table tr.current-scenario {
    background: rgba(74,144,226,0.15);
}

.rank-swing {
    margin: 12px 0 0 0;
    font-size: 13px;
    color: #aaa;
}

.rank-swing strong {
    color: #F5A623;
}

.expand-indicator {
    cursor: pointer;
    user-select: none;
    transition: transform 0.2s ease;
    font-size: 10px;
    color: #666;
    padding: 4px 8px;
}

.main-row:hover .expand-indicator {
    color: #4A90E2;
}

.main-row.expanded .expand-indicator {
    transform: rotate(180deg);
}

/* Scoring Insights Section */
.scoring-insights {
    margin: 32px 0;
    padding: 24px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
}

.scoring-insights h3 {
    margin: 0 0 20px 0;
    color: #4A90E2;
    font-size: 18px;
    border-bottom: 1px solid rgba(74,144,226,0.3);
    padding-bottom: 12px;
}

.insight-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
}

.insight-card {
    background: rgba(0,0,0,0.2);
    border-radius: 6px;
    padding: 16px;
    border-left: 3px solid #4A90E2;
}

.insight-card.correlation {
    border-left-color: #9B59B6;
}

.insight-card.outliers {
    border-left-color: #E74C3C;
}

.insight-card.stability {
    border-left-color: #2ECC71;
}

.insight-card h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 8px;
}

.insight-card p {
    margin: 0 0 8px 0;
    font-size: 13px;
    color: #aaa;
    line-height: 1.5;
}

.insight-card .metric-value {
    font-size: 24px;
    font-weight: 600;
    color: #4A90E2;
    margin-bottom: 8px;
}

.insight-card ul {
    margin: 8px 0 0 0;
    padding-left: 20px;
    font-size: 13px;
    color: #ccc;
}

.insight-card li {
    margin-bottom: 4px;
}

.stable-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 500;
}

.stable-badge.stable {
    background: rgba(46,204,113,0.2);
    color: #2ECC71;
}

.stable-badge.unstable {
    background: rgba(231,76,60,0.2);
    color: #E74C3C;
}

/* Tooltip for stacked bar */
.score-tooltip {
    position: absolute;
    background: rgba(0,0,0,0.9);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 12px;
    color: #fff;
    pointer-events: none;
    z-index: 1000;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.score-tooltip .tooltip-row {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 4px;
}

.score-tooltip .tooltip-row:last-child {
    margin-bottom: 0;
    padding-top: 4px;
    border-top: 1px solid rgba(255,255,255,0.2);
}

.score-tooltip .label {
    color: #888;
}

.score-tooltip .value {
    font-weight: 600;
}

.score-tooltip .value.time {
    color: #4A90E2;
}

.score-tooltip .value.memory {
    color: #F5A623;
}
`;
```

Export this string and ensure it's included in the main styles output. If SharedStyles.ts uses a styles object or concatenates strings, add `scoreDecompositionStyles` appropriately.
  </action>
  <verify>
Run: `grep -c "score-decomposition\|expandable-row\|scoring-insights" Metrics/SharedStyles.ts`
Expected: At least 3 matches (CSS class definitions)

Run: `grep "stacked-bar\|bar-time\|bar-memory" Metrics/SharedStyles.ts | wc -l`
Expected: At least 3 lines (stacked bar styles present)

Run: `grep "insight-card\|insight-grid" Metrics/SharedStyles.ts | wc -l`
Expected: At least 2 lines (insights section styles present)
  </verify>
  <done>
SharedStyles.ts contains CSS for:
- Score decomposition stacked bars (.score-decomposition, .stacked-bar, .bar-time, .bar-memory)
- Expandable row animations (.expandable-row, .sensitivity-details, .expand-indicator)
- Scoring insights sections (.scoring-insights, .insight-card, .insight-grid)
- Tooltip styling (.score-tooltip)
  </done>
</task>

<task type="auto">
  <name>Task 2: Import analysis functions and compute data in HTMLGenerator.ts</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
Modify HTMLGenerator.ts to import and use the scoring analysis functions.

1. Add import at the top of the file (after existing imports):
```typescript
import {
    calculateSensitivityScores,
    calculateRankStability,
    sensitivityMapToArray,
    computeCorrelation,
    identifyOutliers,
    getScorePercentiles,
    WEIGHT_SCENARIOS
} from './scoring-analysis.ts';
```

2. Inside the `generateHtml` function, AFTER the C baseline is determined (around line 194-200 where `cMetrics` is set), add the analysis computation:

```typescript
    // Compute scoring analysis data
    let scoringAnalysisData: {
        sensitivity: Array<{ language: string; scenarios: Array<{ scenario: string; score: number; rank: number }> }>;
        stability: Array<{ language: string; maxSwing: number; bestRank: number; worstRank: number; currentRank: number }>;
        correlation: { rValue: number; rSquared: number; interpretation: string };
        outliers: Array<{ language: string; metric: string; value: number; threshold: number; direction: string; explanation: string }>;
        percentiles: { p25: number; p50: number; p75: number; p90: number; p99: number };
    } = {
        sensitivity: [],
        stability: [],
        correlation: { rValue: 0, rSquared: 0, interpretation: 'N/A' },
        outliers: [],
        percentiles: { p25: 0, p50: 0, p75: 0, p90: 0, p99: 0 }
    };

    if (cMetrics && cMetrics.results.length > 0) {
        // Filter metrics to only those with successful results
        const validMetrics = metrics.filter(m =>
            m.results.some(r => r.status === 'success' && r.time > 0)
        );

        if (validMetrics.length > 0) {
            const sensitivityMap = calculateSensitivityScores(validMetrics, cMetrics.results);
            scoringAnalysisData.sensitivity = sensitivityMapToArray(sensitivityMap);
            scoringAnalysisData.stability = calculateRankStability(sensitivityMap);
            scoringAnalysisData.correlation = computeCorrelation(validMetrics);
            scoringAnalysisData.outliers = identifyOutliers(validMetrics);
            scoringAnalysisData.percentiles = getScorePercentiles(validMetrics);
        }
    }

    const scoringAnalysisJson = safeJSON(scoringAnalysisData);
```

3. Add the JSON data to the HTML template's script section. Find where other data is embedded (look for `const metricsData = ...`) and add:

```javascript
    const scoringAnalysisData = ${scoringAnalysisJson};
    window.scoringAnalysisData = scoringAnalysisData;
```
  </action>
  <verify>
Run: `grep "import.*scoring-analysis" Metrics/HTMLGenerator.ts`
Expected: Shows import statement with analysis functions

Run: `grep "scoringAnalysisData" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 3 matches (declaration, population, embedding)

Run: `grep "calculateSensitivityScores\|computeCorrelation" Metrics/HTMLGenerator.ts`
Expected: Shows function calls

Run: `npx tsc --noEmit Metrics/HTMLGenerator.ts`
Expected: No type errors (exit code 0)
  </verify>
  <done>
HTMLGenerator.ts:
- Imports all analysis functions from scoring-analysis.ts
- Computes sensitivity, stability, correlation, outliers, percentiles during report generation
- Embeds scoringAnalysisData JSON in generated HTML
- Data available via window.scoringAnalysisData for client-side JavaScript
  </done>
</task>

<task type="auto">
  <name>Task 3: Add score decomposition stacked bars and expandable rows to rankings table</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
Modify the rankings table generation in HTMLGenerator.ts to include stacked bars and expandable sensitivity rows.

1. Find the table row generation for the rankings table (search for where solver/language rows are created - likely in a map/forEach over sortedMetrics). The table structure typically creates `<tr>` elements with language name, score, etc.

2. Modify each row to:
   a. Add `class="main-row"` and `onclick="toggleRow('expand-${language}')"`
   b. Replace plain score display with stacked bar + score value
   c. Add expand indicator cell
   d. Add hidden expandable row immediately after

For the score cell, replace the score display with:
```typescript
// Generate score decomposition HTML for a language
function generateScoreDecomposition(score: number, language: string): string {
    // Score is already composite - show 80/20 visual split
    const timePercent = 80;
    const memoryPercent = 20;

    return `
        <div class="score-decomposition"
             onmouseenter="showScoreTooltip(event, '${language}')"
             onmouseleave="hideScoreTooltip()">
            <div class="stacked-bar">
                <div class="bar-segment bar-time" style="width: ${timePercent}%"></div>
                <div class="bar-segment bar-memory" style="width: ${memoryPercent}%"></div>
            </div>
            <span class="score-value">${score.toFixed(2)}</span>
        </div>
    `;
}
```

3. Generate expandable row HTML for each language:
```typescript
function generateExpandableRow(language: string): string {
    const safeId = language.replace(/[^a-zA-Z0-9]/g, '_');
    return `
        <tr id="expand-${safeId}" class="expandable-row" style="display: none;">
            <td colspan="100">
                <div class="sensitivity-details">
                    <h4>Rank Sensitivity Analysis</h4>
                    <table class="sensitivity-table">
                        <thead>
                            <tr>
                                <th>Weight Scenario</th>
                                <th>Rank</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="sensitivity-body-${safeId}">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                    <p class="rank-swing">Max rank swing: <strong id="swing-${safeId}">--</strong> positions</p>
                </div>
            </td>
        </tr>
    `;
}
```

4. Add the JavaScript functions for interactivity in the script section:
```javascript
// Toggle expandable sensitivity row
function toggleRow(rowId) {
    const row = document.getElementById(rowId);
    const mainRow = row.previousElementSibling;

    if (row.style.display === 'none') {
        row.style.display = 'table-row';
        mainRow.classList.add('expanded');
        populateSensitivityRow(rowId);
    } else {
        row.style.display = 'none';
        mainRow.classList.remove('expanded');
    }
}

// Populate sensitivity data when row expands
function populateSensitivityRow(rowId) {
    const language = rowId.replace('expand-', '').replace(/_/g, ' ');
    // Handle special cases like C_Sharp -> C#
    const langLookup = language.replace('C Sharp', 'C#').replace('F Sharp', 'F#').replace('C  ', 'C++');

    const langData = window.scoringAnalysisData.sensitivity.find(s =>
        s.language === langLookup || s.language === language
    );
    const stabilityData = window.scoringAnalysisData.stability.find(s =>
        s.language === langLookup || s.language === language
    );

    if (!langData) return;

    const tbody = document.getElementById('sensitivity-body-' + rowId.replace('expand-', ''));
    const swingEl = document.getElementById('swing-' + rowId.replace('expand-', ''));

    tbody.innerHTML = langData.scenarios.map(s => `
        <tr class="${s.scenario === 'Current (80/20)' ? 'current-scenario' : ''}">
            <td>${s.scenario}</td>
            <td>#${s.rank}</td>
            <td>${s.score.toFixed(3)}</td>
        </tr>
    `).join('');

    if (stabilityData) {
        swingEl.textContent = stabilityData.maxSwing;
    }
}

// Score tooltip functions
let tooltipEl = null;

function showScoreTooltip(event, language) {
    if (!tooltipEl) {
        tooltipEl = document.createElement('div');
        tooltipEl.className = 'score-tooltip';
        document.body.appendChild(tooltipEl);
    }

    const langData = window.scoringAnalysisData.sensitivity.find(s =>
        s.language === language || s.language.replace(/[#\\+]/g, '_') === language.replace(/[#\\+]/g, '_')
    );
    const currentScenario = langData?.scenarios.find(s => s.scenario === 'Current (80/20)');

    if (currentScenario) {
        tooltipEl.innerHTML = `
            <div class="tooltip-row">
                <span class="label">Time (80%):</span>
                <span class="value time">${(currentScenario.score * 0.8 / (0.8 + 0.2)).toFixed(2)}</span>
            </div>
            <div class="tooltip-row">
                <span class="label">Memory (20%):</span>
                <span class="value memory">${(currentScenario.score * 0.2 / (0.8 + 0.2)).toFixed(2)}</span>
            </div>
            <div class="tooltip-row">
                <span class="label">Total:</span>
                <span class="value">${currentScenario.score.toFixed(2)}</span>
            </div>
        `;
    }

    tooltipEl.style.display = 'block';
    tooltipEl.style.left = (event.pageX + 10) + 'px';
    tooltipEl.style.top = (event.pageY - 10) + 'px';
}

function hideScoreTooltip() {
    if (tooltipEl) {
        tooltipEl.style.display = 'none';
    }
}
```

Note: The exact integration point depends on how HTMLGenerator.ts structures the table. Look for loops over `sortedMetrics` and modify the row template to include these elements.
  </action>
  <verify>
Run: `grep "score-decomposition\|stacked-bar" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 2 matches (HTML generation)

Run: `grep "toggleRow\|expandable-row" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 2 matches (JavaScript function and HTML class)

Run: `grep "populateSensitivityRow\|sensitivity-body" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 2 matches (dynamic population)

Run: `npx tsc --noEmit Metrics/HTMLGenerator.ts`
Expected: No type errors
  </verify>
  <done>
Rankings table in HTMLGenerator.ts now includes:
- Stacked bar visualization (80% blue / 20% orange) next to each score
- Clickable rows that expand to show sensitivity analysis
- JavaScript toggleRow() function for smooth expand/collapse
- populateSensitivityRow() populates data dynamically from scoringAnalysisData
- Tooltip shows score breakdown on hover
  </done>
</task>

<task type="auto">
  <name>Task 4: Add Scoring Insights summary section</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
Add a new "Scoring Insights" section to the HTML report that displays:
1. Correlation analysis (R^2 with interpretation)
2. Rank stability highlights (most stable / most unstable languages)
3. Statistical outliers

Find an appropriate location in the HTML template - either above or below the main rankings table. Look for existing section boundaries (likely marked by `<section>` or `<div class="...section">` tags).

Add this section generation:

```typescript
// Generate Scoring Insights section HTML
function generateScoringInsightsSection(): string {
    return `
    <section class="scoring-insights">
        <h3>Scoring Insights</h3>
        <div class="insight-grid">
            <!-- Correlation Card -->
            <div class="insight-card correlation">
                <h4><span>ðŸ“Š</span> Time vs Memory Correlation</h4>
                <div class="metric-value" id="correlation-r2">--</div>
                <p id="correlation-interpretation">Loading...</p>
            </div>

            <!-- Rank Stability Card -->
            <div class="insight-card stability">
                <h4><span>ðŸ“ˆ</span> Rank Stability Analysis</h4>
                <p>How rankings change across different time/memory weight scenarios:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;">
                    <div>
                        <p style="color: #2ECC71; font-weight: 500; margin-bottom: 8px;">Most Stable (Top 5)</p>
                        <ul id="stable-languages" style="color: #ccc;"></ul>
                    </div>
                    <div>
                        <p style="color: #E74C3C; font-weight: 500; margin-bottom: 8px;">Most Volatile (Top 5)</p>
                        <ul id="unstable-languages" style="color: #ccc;"></ul>
                    </div>
                </div>
            </div>

            <!-- Outliers Card -->
            <div class="insight-card outliers">
                <h4><span>ðŸŽ¯</span> Statistical Outliers</h4>
                <p>Languages with exceptional performance characteristics (IQR method):</p>
                <ul id="outlier-list" style="margin-top: 12px;"></ul>
                <p id="no-outliers" style="display: none; color: #888; font-style: italic;">
                    No statistical outliers detected.
                </p>
            </div>
        </div>
    </section>
    `;
}
```

Then add JavaScript to populate the insights section:

```javascript
// Populate Scoring Insights section
function populateScoringInsights() {
    const data = window.scoringAnalysisData;
    if (!data) return;

    // Correlation
    const r2El = document.getElementById('correlation-r2');
    const interpEl = document.getElementById('correlation-interpretation');
    if (r2El && interpEl && data.correlation) {
        r2El.textContent = 'RÂ² = ' + data.correlation.rSquared.toFixed(3);
        interpEl.textContent = data.correlation.interpretation;
    }

    // Rank Stability
    const stableEl = document.getElementById('stable-languages');
    const unstableEl = document.getElementById('unstable-languages');
    if (stableEl && unstableEl && data.stability) {
        // Most stable (lowest swing)
        const sortedByStability = [...data.stability].sort((a, b) => a.maxSwing - b.maxSwing);
        const mostStable = sortedByStability.slice(0, 5);
        stableEl.innerHTML = mostStable.map(s =>
            `<li>${s.language} <span class="stable-badge stable">Â±${s.maxSwing}</span></li>`
        ).join('');

        // Most unstable (highest swing)
        const mostUnstable = sortedByStability.slice(-5).reverse();
        unstableEl.innerHTML = mostUnstable.map(s =>
            `<li>${s.language} <span class="stable-badge unstable">Â±${s.maxSwing}</span></li>`
        ).join('');
    }

    // Outliers
    const outlierListEl = document.getElementById('outlier-list');
    const noOutliersEl = document.getElementById('no-outliers');
    if (outlierListEl && noOutliersEl && data.outliers) {
        if (data.outliers.length === 0) {
            outlierListEl.style.display = 'none';
            noOutliersEl.style.display = 'block';
        } else {
            outlierListEl.innerHTML = data.outliers.map(o =>
                `<li><strong>${o.language}</strong> (${o.metric}): ${o.explanation}</li>`
            ).join('');
        }
    }
}

// Call on page load
document.addEventListener('DOMContentLoaded', populateScoringInsights);
```

Insert the section HTML in the template where appropriate, and add the JavaScript to the script section.
  </action>
  <verify>
Run: `grep "scoring-insights\|insight-card\|insight-grid" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 3 matches (section and card classes)

Run: `grep "correlation-r2\|stable-languages\|outlier-list" Metrics/HTMLGenerator.ts | wc -l`
Expected: At least 3 matches (element IDs)

Run: `grep "populateScoringInsights" Metrics/HTMLGenerator.ts`
Expected: Function definition present

Run: `npx tsc --noEmit Metrics/HTMLGenerator.ts`
Expected: No type errors
  </verify>
  <done>
HTMLGenerator.ts now includes Scoring Insights section with:
- Correlation card showing R^2 value and plain-English interpretation
- Rank Stability card listing top 5 most stable and top 5 most volatile languages
- Outliers card listing statistical outliers with explanations (or "No outliers detected")
- populateScoringInsights() JavaScript function to hydrate section from embedded data
- Section styled with insight-card components in insight-grid layout
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify the complete UI integration:

1. **CSS present:** SharedStyles.ts contains score-decomposition, expandable-row, scoring-insights styles
2. **Analysis computed:** HTMLGenerator.ts imports and calls scoring-analysis functions
3. **Data embedded:** scoringAnalysisData JSON in generated HTML
4. **Stacked bars render:** Rankings table shows 80/20 stacked bars
5. **Expandable rows work:** Clicking language row shows sensitivity data
6. **Insights section present:** Correlation, stability, and outliers displayed

Run complete verification:
```bash
cd /Users/vibe/ClaudeCode/SudokuSolver

# Check CSS
grep -c "score-decomposition\|expandable-row\|scoring-insights" Metrics/SharedStyles.ts

# Check imports
grep "import.*scoring-analysis" Metrics/HTMLGenerator.ts

# Check data embedding
grep "scoringAnalysisData" Metrics/HTMLGenerator.ts | head -3

# Check UI elements
grep -c "stacked-bar\|toggleRow\|populateScoringInsights" Metrics/HTMLGenerator.ts

# Compile check
npx tsc --noEmit Metrics/HTMLGenerator.ts && echo "COMPILE OK"

# Generate report to test
cd Metrics && npx ts-node generate_report_only.ts

# Check generated HTML
grep -c "scoring-insights\|score-decomposition" ../index.html
```
</verification>

<success_criteria>
1. SharedStyles.ts contains CSS for stacked bars, expandable rows, and insights sections
2. HTMLGenerator.ts imports all scoring-analysis functions
3. scoringAnalysisData computed from valid metrics and embedded as JSON in HTML
4. Rankings table rows have:
   - class="main-row" with onclick to toggle expansion
   - Stacked bar (80% blue + 20% orange) next to score value
   - Expand indicator column
   - Hidden expandable row with sensitivity table
5. toggleRow() JavaScript function toggles row visibility and populates sensitivity data
6. Score tooltip shows breakdown on hover (Time 80%, Memory 20%, Total)
7. Scoring Insights section contains 3 cards: Correlation, Rank Stability, Outliers
8. populateScoringInsights() hydrates section from window.scoringAnalysisData on page load
9. Generated index.html contains all new classes and interactive elements
10. No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-scoring-analysis/05-02-SUMMARY.md`
</output>
