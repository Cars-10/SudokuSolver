---
phase: 05.4-tier5-languages
plan: 03
type: execute
---

<objective>
Implement Janet and Pike Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add Lisp-like (Janet) and C-like scripting (Pike) languages to the Tier 5 benchmark suite
Output: Working Janet and Pike solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**

**Janet:**
- Modern Lisp with embeddable design
- Less than 1MB for entire language
- Build from source or use apt package
- Uses arrays and mutable state
- Run with: `janet Sudoku.janet`
- Official: https://janet-lang.org/

**Pike:**
- C-like syntax, dynamic typing
- Available via apt: `apt install pike8.0-core`
- Long history (since 1994), mature
- Run with: `pike Sudoku.pike`
- Official: https://pike.lysator.liu.se/

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```

**Output format must match C exactly:**
```
../Matrices/1.matrix
0 0 0 0 0 0 6 0 0
...
Puzzle:
4 8 9 ...
Solved in Iterations=656
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Janet toolchain to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add Janet language section (build from source for latest version):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 53. Janet (build from source)
       # ----------------------------------------------------------------------------
       RUN git clone --depth 1 https://github.com/janet-lang/janet.git /tmp/janet \
           && cd /tmp/janet \
           && make \
           && make install \
           && rm -rf /tmp/janet
       # janet --version
       ```

    2. Rebuild Docker image:
       ```bash
       docker-compose down
       docker-compose build --no-cache app
       docker-compose up -d
       ```

    3. Verify Janet is installed:
       ```bash
       docker exec sudokusolver-app-1 janet -e '(print "Janet works")'
       ```
  </action>
  <verify>
    docker exec sudokusolver-app-1 janet -e '(print "Janet works")'
  </verify>
  <done>Janet toolchain available in Docker container</done>
</task>

<task type="auto">
  <name>Task 2: Implement Janet solver</name>
  <files>Languages/Janet/Sudoku.janet, Languages/Janet/runMe.sh, Languages/Janet/README.md</files>
  <action>
    1. Create Languages/Janet directory if not exists

    2. Create Sudoku.janet following C algorithm exactly:
       - Janet is a Lisp with arrays and mutable state
       - Use `@[...]` for mutable arrays
       - Use `var` for mutable variables
       - Key syntax patterns:
       ```janet
       (var puzzle @[])
       (var count 0)

       (defn is-valid [row col val]
         # Check row
         (var valid true)
         (for i 0 9
           (when (= (get-in puzzle [row i]) val)
             (set valid false)))
         (when valid
           # Check column
           (for i 0 9
             (when (= (get-in puzzle [i col]) val)
               (set valid false))))
         (when valid
           # Check 3x3 box
           (def box-row (* (div row 3) 3))
           (def box-col (* (div col 3) 3))
           (for i 0 3
             (for j 0 3
               (when (= (get-in puzzle [(+ box-row i) (+ box-col j)]) val)
                 (set valid false)))))
         valid)

       (defn solve []
         # Find empty cell (row-major)
         (var result true)
         (var found-empty false)
         (for row 0 9
           (for col 0 9
             (when (and (not found-empty) (= (get-in puzzle [row col]) 0))
               (set found-empty true)
               (set result false)
               (for val 1 10
                 (++ count)  # COUNT BEFORE is-valid
                 (when (is-valid row col val)
                   (put-in puzzle [row col] val)
                   (when (solve)
                     (set result true)
                     (break))
                   (put-in puzzle [row col] 0)))
               (break))
             (when found-empty (break))))
         (if found-empty result true))
       ```

    3. Handle command line argument:
       ```janet
       (def filename (get (dyn :args) 1))
       ```

    4. Output format matching C exactly

    5. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Janet"
       source ../common.sh
       run_benchmark "janet Sudoku.janet"
       ```

    6. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Janet && janet Sudoku.janet /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Janet solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 3: Add Pike toolchain and implement solver</name>
  <files>server/Dockerfile, Languages/Pike/Sudoku.pike, Languages/Pike/runMe.sh, Languages/Pike/README.md</files>
  <action>
    1. Add Pike to Dockerfile (easy - apt package):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 54. Pike
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           pike8.0-core \
           && rm -rf /var/lib/apt/lists/*
       # pike --version
       ```

    2. Rebuild Docker image

    3. Create Languages/Pike directory

    4. Create Sudoku.pike following C algorithm:
       - Pike has C-like syntax with dynamic typing
       - Key syntax patterns:
       ```pike
       #!/usr/bin/env pike

       array(array(int)) puzzle = allocate(9);
       int count = 0;

       int is_valid(int row, int col, int val) {
           // Check row
           for (int i = 0; i < 9; i++) {
               if (puzzle[row][i] == val) return 0;
           }
           // Check column
           for (int i = 0; i < 9; i++) {
               if (puzzle[i][col] == val) return 0;
           }
           // Check 3x3 box
           int box_row = (row / 3) * 3;
           int box_col = (col / 3) * 3;
           for (int i = 0; i < 3; i++) {
               for (int j = 0; j < 3; j++) {
                   if (puzzle[box_row + i][box_col + j] == val) return 0;
               }
           }
           return 1;
       }

       int solve() {
           // Find empty cell (row-major)
           for (int row = 0; row < 9; row++) {
               for (int col = 0; col < 9; col++) {
                   if (puzzle[row][col] == 0) {
                       for (int val = 1; val <= 9; val++) {
                           count++;  // COUNT BEFORE is_valid
                           if (is_valid(row, col, val)) {
                               puzzle[row][col] = val;
                               if (solve()) return 1;
                               puzzle[row][col] = 0;
                           }
                       }
                       return 0;
                   }
               }
           }
           return 1;
       }

       int main(int argc, array(string) argv) {
           string filename = argv[1];
           // Read file, solve, print output
           ...
       }
       ```

    5. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Pike"
       source ../common.sh
       run_benchmark "pike Sudoku.pike"
       ```

    6. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Pike && pike Sudoku.pike /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Pike solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 4: Validate both languages on all matrices</name>
  <files>Languages/Janet/metrics.json, Languages/Pike/metrics.json</files>
  <action>
    1. Run full validation for Janet:
       ```bash
       cd Languages/Janet && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    2. Run full validation for Pike:
       ```bash
       cd Languages/Pike && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    3. Verify all iteration counts match:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    4. If any mismatch, debug and fix

    5. Regenerate benchmark report:
       ```bash
       cd server && npx tsx generate_report_only.ts
       ```

    6. Update README.md files with validation results
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/Janet/metrics.json /app/Languages/Pike/metrics.json 2>/dev/null" | grep -o '"iterations": [0-9]*' | head -10
  </verify>
  <done>Both Janet and Pike validated on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with Janet and Pike
- [ ] Janet solver: Lisp-style iteration counting correct
- [ ] Pike solver: C-style iteration count++ BEFORE is_valid
- [ ] Both match all 5 iteration counts (656, 439269, 98847, 9085, 445778)
- [ ] Both runMe.sh scripts follow common.sh pattern
- [ ] Both README.md files document validation status
- [ ] Benchmark report regenerated with new languages
</verification>

<success_criteria>
- Janet and Pike fully validated on all 5 matrices
- Both use established common.sh benchmark pattern
- Documentation complete for both languages
- 52-53 languages total passing validation
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-tier5-languages/05.4-03-SUMMARY.md`
</output>
