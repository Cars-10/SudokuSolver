---
phase: 05.4-tier5-languages
plan: 01
type: execute
---

<objective>
Implement Io and Factor Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add prototype-based (Io) and concatenative (Factor) paradigm languages to the Tier 5 benchmark suite
Output: Working Io and Factor solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**

**Io:**
- Prototype-based OOP inspired by Self, Smalltalk, and LISP
- Everything is an object, message passing paradigm
- Build from source: cmake, make, make install
- Run with: `io Sudoku.io`
- GitHub: https://github.com/IoLanguage/io

**Factor:**
- Concatenative, stack-based language
- Download pre-built binary from factorcode.org
- Requires: libfreetype6-dev, libx11-dev (for GUI, may not need for CLI)
- Run with: `factor Sudoku.factor` or `factor -run=sudoku`
- Official: https://factorcode.org/

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```

**Output format must match C exactly:**
```
../Matrices/1.matrix
0 0 0 0 0 0 6 0 0
...
Puzzle:
4 8 9 ...
Solved in Iterations=656
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Io toolchain to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add Io language section after Tier 4 languages:
       ```dockerfile
       # TIER 5 LANGUAGES
       # ----------------------------------------------------------------------------
       # 49. Io (build from source)
       # ----------------------------------------------------------------------------
       RUN apt-get update && apt-get install -y \
           cmake \
           && rm -rf /var/lib/apt/lists/* \
           && git clone --depth 1 https://github.com/IoLanguage/io.git /tmp/io \
           && cd /tmp/io \
           && mkdir build && cd build \
           && cmake .. \
           && make -j$(nproc) \
           && make install \
           && ldconfig \
           && rm -rf /tmp/io
       # io --version
       ```

    2. Rebuild Docker image:
       ```bash
       docker-compose down
       docker-compose build --no-cache app
       docker-compose up -d
       ```

    3. Verify Io is installed:
       ```bash
       docker exec sudokusolver-app-1 io -e 'writeln("Hello from Io")'
       ```
  </action>
  <verify>
    docker exec sudokusolver-app-1 io -e '"Io works" println'
  </verify>
  <done>Io toolchain available in Docker container</done>
</task>

<task type="auto">
  <name>Task 2: Implement Io solver</name>
  <files>Languages/Io/Sudoku.io, Languages/Io/runMe.sh, Languages/Io/README.md</files>
  <action>
    1. Create Languages/Io directory if not exists

    2. Create Sudoku.io following C algorithm exactly:
       - Io uses prototype-based OOP with message passing
       - Use List for 2D array: `puzzle := List clone`
       - Iteration counting: `count = count + 1` BEFORE isValid check
       - Row-major traversal for empty cell search

       Key Io syntax:
       ```io
       Sudoku := Object clone do(
           puzzle := nil
           count := 0

           solve := method(
               // Find empty cell (row-major)
               for(row, 0, 8,
                   for(col, 0, 8,
                       if(puzzle at(row) at(col) == 0,
                           for(val, 1, 9,
                               count = count + 1  // COUNT BEFORE isValid
                               if(isValid(row, col, val),
                                   puzzle at(row) atPut(col, val)
                                   if(solve, return true)
                                   puzzle at(row) atPut(col, 0)
                               )
                           )
                           return false
                       )
                   )
               )
               true
           )

           isValid := method(row, col, val,
               // Check row, column, 3x3 box
               ...
           )
       )
       ```

    3. Handle command line argument for matrix file:
       ```io
       filename := System args at(1)
       ```

    4. Output format matching C:
       - Print filename (normalized path)
       - Print input puzzle (space-separated)
       - Print "\nPuzzle:" header
       - Print solved puzzle
       - Print "Solved in Iterations=N"

    5. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Io"
       source ../common.sh
       run_benchmark "io Sudoku.io"
       ```

    6. Create README.md documenting:
       - Language paradigm (prototype-based)
       - Build/installation notes
       - Validation status
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Io && io Sudoku.io /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Io solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 3: Add Factor toolchain and implement solver</name>
  <files>server/Dockerfile, Languages/Factor/Sudoku.factor, Languages/Factor/runMe.sh, Languages/Factor/README.md</files>
  <action>
    1. Add Factor to Dockerfile (download pre-built binary):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 50. Factor (download pre-built binary)
       # ----------------------------------------------------------------------------
       RUN curl -L https://downloads.factorcode.org/releases/0.99/factor-linux-x86-64-0.99.tar.gz \
           -o /tmp/factor.tar.gz \
           && tar -xzf /tmp/factor.tar.gz -C /opt \
           && ln -s /opt/factor/factor /usr/local/bin/factor \
           && rm /tmp/factor.tar.gz
       # factor -version
       ```

    2. Rebuild Docker image

    3. Create Languages/Factor directory

    4. Create Sudoku.factor following C algorithm:
       - Factor is stack-based concatenative
       - Use arrays for puzzle storage
       - Key syntax patterns:
       ```factor
       USING: arrays io kernel math sequences ;
       IN: sudoku

       SYMBOL: puzzle
       SYMBOL: count

       : increment-count ( -- ) count get 1 + count set ;

       : is-valid? ( row col val -- ? )
           ! Check row, column, 3x3 box
           ... ;

       : solve ( -- ? )
           ! Find empty cell, try values 1-9
           9 [0..b) [| row |
               9 [0..b) [| col |
                   row col puzzle-at 0 = [
                       9 [1..b] [| val |
                           increment-count  ! COUNT BEFORE is-valid?
                           row col val is-valid? [
                               row col val puzzle-set
                               solve [ t ] [ row col 0 puzzle-set f ] if
                           ] [ f ] if
                       ] any?
                   ] [ t ] if
               ] all?
           ] all? ;
       ```

    5. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Factor"
       source ../common.sh
       run_benchmark "factor -run=sudoku"
       ```

       Note: Factor may need special invocation - test with:
       - `factor Sudoku.factor`
       - `factor -script=Sudoku.factor`
       - Or compile to standalone

    6. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Factor && factor Sudoku.factor /app/Matrices/1.matrix 2>/dev/null || factor -script=Sudoku.factor /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Factor solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 4: Validate both languages on all matrices</name>
  <files>Languages/Io/metrics.json, Languages/Factor/metrics.json</files>
  <action>
    1. Run full validation for Io:
       ```bash
       cd Languages/Io && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    2. Run full validation for Factor:
       ```bash
       cd Languages/Factor && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    3. Verify all iteration counts match:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    4. If any mismatch, debug and fix:
       - Check iteration increment placement
       - Verify row-major traversal order
       - Check output format

    5. Regenerate benchmark report:
       ```bash
       cd server && npx tsx generate_report_only.ts
       ```

    6. Update README.md files with validation results
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/Io/metrics.json /app/Languages/Factor/metrics.json 2>/dev/null" | grep -o '"iterations": [0-9]*' | head -10
  </verify>
  <done>Both Io and Factor validated on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with Io and Factor
- [ ] Io solver: iteration count++ BEFORE isValid check
- [ ] Factor solver: stack-based iteration counting correct
- [ ] Both match all 5 iteration counts (656, 439269, 98847, 9085, 445778)
- [ ] Both runMe.sh scripts follow common.sh pattern
- [ ] Both README.md files document validation status
- [ ] Benchmark report regenerated with new languages
</verification>

<success_criteria>
- Io and Factor fully validated on all 5 matrices
- Both use established common.sh benchmark pattern
- Documentation complete for both languages
- 49 languages total passing validation (47 + 2)
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-tier5-languages/05.4-01-SUMMARY.md`
</output>
