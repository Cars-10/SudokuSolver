---
phase: 05.4-tier5-languages
plan: 02
type: execute
---

<objective>
Implement Red and Wren Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add dialect-oriented (Red) and embeddable scripting (Wren) languages to the Tier 5 benchmark suite
Output: Working Red and Wren solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Language notes:**

**Red:**
- Rebol successor, dialect-oriented DSL language
- IMPORTANT: Currently 32-bit only, alpha stage
- Requires 32-bit libraries on 64-bit Linux:
  ```bash
  dpkg --add-architecture i386
  apt-get install libc6:i386 libcurl4:i386
  ```
- Download binary from red-lang.org
- Run with: `./red Sudoku.red` or `./red -s Sudoku.red`
- Official: https://www.red-lang.org/

**Wren:**
- Small, fast, class-based scripting language
- Download pre-built wren_cli binary from GitHub releases
- Run with: `wren Sudoku.wren`
- Official: https://wren.io/

**Critical algorithm requirement:**
```c
for (int val = 1; val <= 9; val++) {
    count++;  // COUNT BEFORE validity check
    if (isValid(row, col, val)) { ... }
}
```

**Output format must match C exactly:**
```
../Matrices/1.matrix
0 0 0 0 0 0 6 0 0
...
Puzzle:
4 8 9 ...
Solved in Iterations=656
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Red toolchain to Dockerfile</name>
  <files>server/Dockerfile</files>
  <action>
    1. Add Red language section (requires 32-bit support):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 51. Red (download binary - requires 32-bit libs)
       # ----------------------------------------------------------------------------
       RUN dpkg --add-architecture i386 \
           && apt-get update && apt-get install -y \
           libc6:i386 \
           libcurl4:i386 \
           && rm -rf /var/lib/apt/lists/* \
           && curl -L https://static.red-lang.org/dl/linux/red-latest \
           -o /usr/local/bin/red \
           && chmod +x /usr/local/bin/red
       # red --version
       ```

    2. Rebuild Docker image:
       ```bash
       docker-compose down
       docker-compose build --no-cache app
       docker-compose up -d
       ```

    3. Verify Red is installed:
       ```bash
       docker exec sudokusolver-app-1 red --version
       ```

    Note: If Red binary fails (32-bit issues), we may need to defer this language or find alternative approach.
  </action>
  <verify>
    docker exec sudokusolver-app-1 red -e 'print "Red works"' || echo "Red may have 32-bit issues"
  </verify>
  <done>Red toolchain available in Docker container (or documented as deferred)</done>
</task>

<task type="auto">
  <name>Task 2: Implement Red solver (or defer if toolchain issues)</name>
  <files>Languages/Red/Sudoku.red, Languages/Red/runMe.sh, Languages/Red/README.md</files>
  <action>
    1. Create Languages/Red directory if not exists

    2. If Red works, create Sudoku.red following C algorithm:
       - Red uses Rebol-like syntax with blocks
       - Arrays via block! type
       - Key syntax patterns:
       ```red
       Red []

       puzzle: copy []
       count: 0

       is-valid: func [row col val] [
           ; Check row
           repeat i 9 [
               if puzzle/(row)/(i) = val [return false]
           ]
           ; Check column
           repeat i 9 [
               if puzzle/(i)/(col) = val [return false]
           ]
           ; Check 3x3 box
           box-row: (row - 1) / 3 * 3 + 1
           box-col: (col - 1) / 3 * 3 + 1
           repeat i 3 [
               repeat j 3 [
                   if puzzle/(box-row + i - 1)/(box-col + j - 1) = val [return false]
               ]
           ]
           true
       ]

       solve: func [] [
           ; Find empty cell (row-major)
           repeat row 9 [
               repeat col 9 [
                   if puzzle/(row)/(col) = 0 [
                       repeat val 9 [
                           count: count + 1  ; COUNT BEFORE is-valid
                           if is-valid row col val [
                               puzzle/(row)/(col): val
                               if solve [return true]
                               puzzle/(row)/(col): 0
                           ]
                       ]
                       return false
                   ]
               ]
           ]
           true
       ]
       ```

    3. If Red has 32-bit issues, document in README.md as deferred and skip implementation

    4. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Red"
       source ../common.sh
       run_benchmark "red Sudoku.red"
       ```

    5. Create README.md documenting:
       - Language paradigm (dialect-oriented)
       - 32-bit limitation notes
       - Validation status or deferral reason
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Red && red Sudoku.red /app/Matrices/1.matrix 2>/dev/null" | grep "Iterations=656" || echo "Red may be deferred"
  </verify>
  <done>Red solver matches C reference OR documented as deferred due to toolchain issues</done>
</task>

<task type="auto">
  <name>Task 3: Add Wren toolchain and implement solver</name>
  <files>server/Dockerfile, Languages/Wren/Sudoku.wren, Languages/Wren/runMe.sh, Languages/Wren/README.md</files>
  <action>
    1. Add Wren CLI to Dockerfile (download pre-built binary):
       ```dockerfile
       # ----------------------------------------------------------------------------
       # 52. Wren (download pre-built CLI binary)
       # ----------------------------------------------------------------------------
       RUN curl -L https://github.com/wren-lang/wren-cli/releases/download/0.4.0/wren_cli-linux-0.4.0.zip \
           -o /tmp/wren.zip \
           && unzip /tmp/wren.zip -d /tmp/wren \
           && mv /tmp/wren/wren_cli /usr/local/bin/wren \
           && chmod +x /usr/local/bin/wren \
           && rm -rf /tmp/wren /tmp/wren.zip
       # wren --version
       ```

    2. Rebuild Docker image

    3. Create Languages/Wren directory

    4. Create Sudoku.wren following C algorithm:
       - Wren is class-based with clean syntax
       - Key syntax patterns:
       ```wren
       import "os" for Process
       import "io" for File

       class Sudoku {
           construct new() {
               _puzzle = List.filled(9, null)
               for (i in 0...9) {
                   _puzzle[i] = List.filled(9, 0)
               }
               _count = 0
           }

           count { _count }

           isValid(row, col, val) {
               // Check row
               for (i in 0...9) {
                   if (_puzzle[row][i] == val) return false
               }
               // Check column
               for (i in 0...9) {
                   if (_puzzle[i][col] == val) return false
               }
               // Check 3x3 box
               var boxRow = (row / 3).floor * 3
               var boxCol = (col / 3).floor * 3
               for (i in 0...3) {
                   for (j in 0...3) {
                       if (_puzzle[boxRow + i][boxCol + j] == val) return false
                   }
               }
               return true
           }

           solve() {
               // Find empty cell (row-major)
               for (row in 0...9) {
                   for (col in 0...9) {
                       if (_puzzle[row][col] == 0) {
                           for (val in 1..9) {
                               _count = _count + 1  // COUNT BEFORE isValid
                               if (isValid(row, col, val)) {
                                   _puzzle[row][col] = val
                                   if (solve()) return true
                                   _puzzle[row][col] = 0
                               }
                           }
                           return false
                       }
                   }
               }
               return true
           }
       }
       ```

    5. Create runMe.sh:
       ```bash
       #!/bin/bash
       LANGUAGE="Wren"
       source ../common.sh
       run_benchmark "wren Sudoku.wren"
       ```

    6. Create README.md
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cd /app/Languages/Wren && wren Sudoku.wren /app/Matrices/1.matrix" | grep "Iterations=656"
  </verify>
  <done>Wren solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 4: Validate languages on all matrices</name>
  <files>Languages/Red/metrics.json, Languages/Wren/metrics.json</files>
  <action>
    1. Run full validation for Red (if not deferred):
       ```bash
       cd Languages/Red && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    2. Run full validation for Wren:
       ```bash
       cd Languages/Wren && chmod +x runMe.sh
       for m in 1 2 3 4 5; do
           ./runMe.sh /app/Matrices/$m.matrix
       done
       ```

    3. Verify all iteration counts match:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    4. If any mismatch, debug and fix

    5. Regenerate benchmark report:
       ```bash
       cd server && npx tsx generate_report_only.ts
       ```

    6. Update STATE.md with language status:
       - If Red deferred, add to Tier 5 table with status "Deferred"
       - Update total language count
  </action>
  <verify>
    docker exec sudokusolver-app-1 bash -c "cat /app/Languages/Wren/metrics.json 2>/dev/null" | grep -o '"iterations": [0-9]*' | head -5
  </verify>
  <done>Wren validated on all 5 matrices (Red validated or documented as deferred)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Docker image rebuilt with Red (32-bit libs) and Wren
- [ ] Red solver working OR documented as deferred with clear reason
- [ ] Wren solver: iteration count++ BEFORE isValid check
- [ ] Working solvers match all 5 iteration counts
- [ ] Both runMe.sh scripts follow common.sh pattern
- [ ] Both README.md files document validation status
- [ ] Benchmark report regenerated
</verification>

<success_criteria>
- Wren fully validated on all 5 matrices
- Red validated OR clearly documented as deferred (32-bit limitation)
- Documentation complete for both languages
- 50-51 languages total passing validation
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-tier5-languages/05.4-02-SUMMARY.md`
</output>
