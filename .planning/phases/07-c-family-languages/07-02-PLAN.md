---
phase: 07-c-family-languages
plan: 02
type: execute
depends_on: []
files_modified: [
  Algorithms/DLX/C_Sharp/DLX.cs,
  Algorithms/DLX/C_Sharp/runMe.sh,
  Algorithms/CP/C_Sharp/CP.cs,
  Algorithms/CP/C_Sharp/runMe.sh
]
---

<objective>
Implement DLX and CP algorithms for C# using .NET idioms while maintaining algorithmic compatibility with C reference implementations.

Purpose: Extend algorithm coverage to C# as a managed language representative in the C-family, demonstrating algorithm portability across memory management paradigms.
Output: Functional DLX and CP solvers in C# with verified iteration counts matching C reference (DLX: 43, CP: 67 on Matrix 1).
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# C reference implementations
@Algorithms/DLX/C/dlx.h
@Algorithms/DLX/C/dlx_core.c
@Algorithms/DLX/C/dlx_sudoku.c
@Algorithms/CP/C/cp.h
@Algorithms/CP/C/cp_core.c
@Algorithms/CP/C/cp_sudoku.c

# C# benchmark pattern (from BruteForce)
@Algorithms/BruteForce/C_Sharp/runMe.sh

**Tech stack available:**
- C# compiler (csc or dotnet)
- Existing benchmark harness (common.sh)
- Established algorithm patterns from v1.1

**Established patterns:**
- C# directory name: `C_Sharp` (underscore, not special char)
- LANGUAGE variable in runMe.sh must match directory name: "C_Sharp"
- Single-file C# implementation common for small programs
- Use `dotnet` or `csc` for compilation

**Constraining decisions:**
- Phase 2: DLX iteration counting = search calls
- Phase 3: CP iteration counting = assign() calls
- Port algorithm logic faithfully (no LINQ for core algorithm)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Port DLX algorithm to C#</name>
  <files>Algorithms/DLX/C_Sharp/DLX.cs, Algorithms/DLX/C_Sharp/runMe.sh</files>
  <action>
Create Algorithms/DLX/C_Sharp/ directory. Port the C DLX implementation to C#:

1. **DLX.cs**: Single-file implementation
   - Create `class DlxNode` with properties: Up, Down, Left, Right, Column, RowId
   - Create `class DlxColumn : DlxNode` with additional Size and Name properties
   - Implement CoverColumn(), UncoverColumn(), ChooseColumn(), DlxSearch()
   - Implement BuildDlxMatrixFromPuzzle() for exact cover mapping
   - Implement ExtractSolution() to convert DLX solution to Sudoku grid
   - Static field `static int dlxIterations = 0` for iteration counting
   - Main() method: read matrix file, build DLX matrix, solve, print results
   - Use arrays and manual linking (no List&lt;T&gt; for node structure)

2. **runMe.sh**: Create build script
   - Set `LANGUAGE="C_Sharp"` (must match directory name exactly)
   - Set SOLVER_BINARY="./dlx_solver", METRICS_FILE="metrics.json"
   - Source ../../common.sh
   - compile() function: `csc -out:dlx_solver.exe DLX.cs` or `dotnet build` as appropriate
   - Handle .exe extension for solver binary if needed
   - Call main "$@"

**Critical**: C# uses classes and properties, but maintain pointer-style logic with references. Keep algorithm structure identical.
  </action>
  <verify>
cd Algorithms/DLX/C_Sharp && ./runMe.sh ../../Matrices/1.matrix
Check output shows "Iterations=43" (must match C reference)
  </verify>
  <done>DLX C# implementation compiles, runs, produces 43 iterations on Matrix 1, metrics.json generated with LANGUAGE="C_Sharp"</done>
</task>

<task type="auto">
  <name>Task 2: Port CP algorithm to C#</name>
  <files>Algorithms/CP/C_Sharp/CP.cs, Algorithms/CP/C_Sharp/runMe.sh</files>
  <action>
Create Algorithms/CP/C_Sharp/ directory. Port the C CP implementation to C#:

1. **CP.cs**: Single-file implementation
   - Create `class CPGrid` with: int[,] Values (9x9), ushort[,] Candidates (9x9)
   - Use `ushort` (uint16_t equivalent) for candidate bitsets
   - Implement HasCandidate(), AddCandidate(), RemoveCandidate(), CountCandidates() as methods or properties
   - Implement InitGrid(), Propagate(), Eliminate(), Assign(), CpSearch(), FindMrvCell()
   - Static field `static long cpIterations = 0` for iteration counting
   - Main() method: read matrix file, init grid, search, print results
   - Maintain bitset operations using bitwise operators (&, |, ~, <<)

2. **runMe.sh**: Create build script
   - Set `LANGUAGE="C_Sharp"` (must match directory name exactly)
   - Set SOLVER_BINARY="./cp_solver", METRICS_FILE="metrics.json"
   - Source ../../common.sh
   - compile() function: `csc -out:cp_solver.exe CP.cs` or `dotnet build` as appropriate
   - Handle .exe extension for solver binary if needed
   - Call main "$@"

**Critical**: Keep propagation order and MRV heuristic identical to C to ensure iteration counts match.
  </action>
  <verify>
cd Algorithms/CP/C_Sharp && ./runMe.sh ../../Matrices/1.matrix
Check output shows "Iterations=67" (must match C reference)
  </verify>
  <done>CP C# implementation compiles, runs, produces 67 iterations on Matrix 1, metrics.json generated with LANGUAGE="C_Sharp"</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both DLX and CP C# implementations compile without errors
- [ ] DLX C# produces exactly 43 iterations on Matrix 1
- [ ] CP C# produces exactly 67 iterations on Matrix 1
- [ ] Both metrics.json files have LANGUAGE="C_Sharp" (matching directory name)
- [ ] Both implementations run via runMe.sh successfully
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- DLX C# iteration count matches C reference (43)
- CP C# iteration count matches C reference (67)
- Both implementations integrated into benchmark system
- LANGUAGE variable correctly set to "C_Sharp"
  </success_criteria>

<output>
After completion, create `.planning/phases/07-c-family-languages/07-02-SUMMARY.md`:

# Phase 7 Plan 2: C# Algorithms Summary

**Established DLX and CP algorithm implementations for C# with verified correctness**

## Accomplishments

- Ported DLX algorithm to C# (DLX.cs single-file implementation)
- Ported CP algorithm to C# (CP.cs single-file implementation)
- Verified iteration counts match C reference (DLX: 43, CP: 67)
- Integrated both algorithms into benchmark system

## Files Created/Modified

- `Algorithms/DLX/C_Sharp/DLX.cs` - Complete DLX implementation
- `Algorithms/DLX/C_Sharp/runMe.sh` - Build and benchmark script
- `Algorithms/CP/C_Sharp/CP.cs` - Complete CP implementation
- `Algorithms/CP/C_Sharp/runMe.sh` - Build and benchmark script

## Decisions Made

[Record any C#-specific decisions: class structure, .NET version, compilation approach]

## Issues Encountered

[Record any compilation issues, .NET compatibility issues, or algorithm discrepancies]

## Next Step

Ready for 07-03-PLAN.md (Objective-C implementation)
</output>
