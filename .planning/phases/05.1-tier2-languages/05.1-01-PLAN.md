---
phase: 05.1-tier2-languages
plan: 01
type: execute
---

<objective>
Implement Lua and Bash Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add two scripting languages to the Tier 2 benchmark suite
Output: Working Lua and Bash solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phases establishing pattern:**
@.planning/phases/03-scripting-languages/03-01-SUMMARY.md

**Reference implementation:**
@Languages/C/Sudoku.c
@Languages/Python/Sudoku.py

**Existing code (stubs/partial):**
@Languages/Lua/Sudoku.lua (placeholder only - needs full implementation)
@Languages/BASH/ (check for existing code)

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Required output format (from C reference):**
```
../../Matrices/1.matrix
9 2 0 0 0 0 5 8 4
... (raw matrix lines as read)

Puzzle:
9 2 0 0 0 0 5 8 4
... (initial puzzle)

Puzzle:
9 2 1 6 3 7 5 8 4
... (solved puzzle)

Solved in Iterations=656

Seconds to process 0.001
```

**Algorithm requirements:**
- Row-major order scanning (top-to-bottom, left-to-right)
- Try values 1-9 in ascending order
- Count EVERY placement attempt (not just valid ones)
- Backtracking when no valid value found
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Lua solver</name>
  <files>Languages/Lua/Sudoku.lua, Languages/Lua/runMe.sh, Languages/Lua/README.md</files>
  <action>
    1. Rewrite Sudoku.lua from scratch (current is placeholder):
       - Read matrix file path from command line arg
       - Parse 9x9 grid (skip comments starting with #)
       - Print path, then raw rows as read
       - Print "Puzzle:" header + initial state
       - Implement brute-force solver:
         * Find first empty cell (row-major: row 0-8, col 0-8)
         * Try values 1-9 in order
         * INCREMENT counter for EVERY attempt (before validity check)
         * Check row/col/box constraints
         * Recurse on valid placement, backtrack on failure
       - Print "Puzzle:" header + solved state
       - Print "Solved in Iterations={count}"
       - Print "Seconds to process {time:.3f}"

    2. Use os.clock() for timing in Lua

    3. Create runMe.sh:
       - LANGUAGE="Lua"
       - SOLVER_BINARY="lua Sudoku.lua"
       - Source ../common.sh
       - Check lua availability with check_toolchain

    4. Create README.md with validation table
  </action>
  <verify>
    cd Languages/Lua && lua Sudoku.lua ../../Matrices/1.matrix 2>/dev/null | grep "Iterations=656"
  </verify>
  <done>Lua solver matches C reference output format and iteration count (656) for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 2: Validate Lua on all matrices</name>
  <files>Languages/Lua/metrics.json</files>
  <action>
    1. Run Lua solver on all 5 matrices:
       cd Languages/Lua && ./runMe.sh ../../Matrices/{1,2,3,4,5}.matrix

    2. Verify iteration counts match exactly:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    3. Update README.md with validation results and timing

    4. If any count doesn't match, debug the algorithm:
       - Check cell scanning order (must be row-major)
       - Check value order (must be 1-9 ascending)
       - Check counter increment position (before isValid check)
  </action>
  <verify>
    grep -o '"iterations": [0-9]*' Languages/Lua/metrics.json | head -5
  </verify>
  <done>All 5 matrices pass with exact iteration counts in metrics.json</done>
</task>

<task type="auto">
  <name>Task 3: Implement Bash solver</name>
  <files>Languages/BASH/Sudoku.sh, Languages/BASH/runMe.sh, Languages/BASH/README.md</files>
  <action>
    1. Create Sudoku.sh (pure Bash, no external tools except basic utilities):
       - Read matrix file from $1
       - Use 2D array simulation with associative array or indexed array
       - Parse grid (skip # comments)
       - Print path, raw rows, "Puzzle:" headers
       - Implement brute-force solver:
         * Row-major cell scanning
         * Values 1-9 in order
         * Count every attempt
         * Row/col/box validation
         * Recursive solve with backtracking
       - Print iteration count and timing

    2. Use SECONDS or date for timing (Bash has limited precision)

    3. Create runMe.sh:
       - LANGUAGE="Bash"
       - SOLVER_BINARY="bash Sudoku.sh"
       - Source ../common.sh

    4. Create README.md

    Note: Bash will be SLOW (possibly timeout on larger matrices).
    This is expected - we're testing correctness, not performance.
  </action>
  <verify>
    cd Languages/BASH && bash Sudoku.sh ../../Matrices/1.matrix 2>/dev/null | grep "Iterations=656"
  </verify>
  <done>Bash solver matches C reference for Matrix 1 (656 iterations)</done>
</task>

<task type="auto">
  <name>Task 4: Validate Bash on matrices (expect timeouts)</name>
  <files>Languages/BASH/metrics.json</files>
  <action>
    1. Run Bash solver starting with Matrix 1:
       cd Languages/BASH && ./runMe.sh ../../Matrices/1.matrix

    2. Verify Matrix 1 iteration count: 656

    3. Attempt larger matrices (expect timeouts):
       - Matrix 2 (439K iterations) - likely timeout
       - Matrix 3-5 - likely timeout

    4. Document timeout behavior in README.md
       - Note which matrices complete within 5 min timeout
       - This is acceptable - Bash is inherently slow for this algorithm

    5. Update README.md with honest assessment:
       - "Bash completes Matrix 1 in X seconds"
       - "Matrices 2-5 timeout (expected for shell scripting)"
  </action>
  <verify>
    grep -o '"iterations": [0-9]*' Languages/BASH/metrics.json | head -1
  </verify>
  <done>Bash solver validated on Matrix 1, timeout behavior documented for larger matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Lua solver produces exact output format matching C
- [ ] Lua iteration counts match: 656, 439269, 98847, 9085, 445778
- [ ] Lua metrics.json populated with all 5 results
- [ ] Bash solver produces exact output format matching C
- [ ] Bash iteration count matches for Matrix 1: 656
- [ ] Both README.md files document validation status
- [ ] Both runMe.sh scripts use common.sh pattern
</verification>

<success_criteria>
- Lua fully validated on all 5 matrices
- Bash validated on Matrix 1 (timeout on larger matrices is acceptable)
- Both languages follow established benchmark patterns
- Documentation complete
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-tier2-languages/05.1-01-SUMMARY.md`
</output>
