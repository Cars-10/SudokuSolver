---
phase: 05.1-tier2-languages
plan: 02
type: execute
---

<objective>
Implement D, Nim, and Crystal Sudoku solvers with exact algorithm match and C reference output format.

Purpose: Add three modern compiled systems languages to the Tier 2 benchmark suite
Output: Working D, Nim, and Crystal solvers passing all 5 matrix validations with exact iteration counts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phases establishing pattern:**
@.planning/phases/02-compiled-languages-wave/02-01-SUMMARY.md

**Reference implementation:**
@Languages/C/Sudoku.c

**Existing code directories:**
@Languages/D/
@Languages/Nim/
@Languages/Crystal/

**Reference iteration counts:**
- Matrix 1: 656
- Matrix 2: 439,269
- Matrix 3: 98,847
- Matrix 4: 9,085
- Matrix 5: 445,778

**Algorithm requirements:**
- Row-major order scanning (top-to-bottom, left-to-right)
- Try values 1-9 in ascending order
- Count EVERY placement attempt (before validity check)
- Backtracking when no valid value found

**Compilation notes:**
- D: dmd or ldc2 compiler, similar to C syntax
- Nim: nim c -d:release, compiles to C
- Crystal: crystal build --release, Ruby-like syntax
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement D solver</name>
  <files>Languages/D/Sudoku.d, Languages/D/runMe.sh, Languages/D/README.md</files>
  <action>
    1. Create/fix Sudoku.d:
       - D has C-like syntax with modern features
       - Use int[9][9] for puzzle grid
       - Global count variable for iterations
       - readMatrixFile() - print path, parse and echo rows
       - printPuzzle() - "Puzzle:" header format
       - isValid(row, col, val) - check row/col/box
       - solve() - brute-force with row-major scanning
         * Increment count for EVERY val 1-9 attempt
       - main() - timing with MonoTime or StopWatch

    2. Create runMe.sh:
       - LANGUAGE="D"
       - COMPILE_CMD="dmd -O -release -of=Sudoku Sudoku.d"
       - SOLVER_BINARY="./Sudoku"
       - Source ../common.sh

    3. Create README.md with validation table
  </action>
  <verify>
    cd Languages/D && dmd -O Sudoku.d -of=Sudoku && ./Sudoku ../../Matrices/1.matrix | grep "Iterations=656"
  </verify>
  <done>D solver matches C reference output format and iteration count (656) for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 2: Implement Nim solver</name>
  <files>Languages/Nim/Sudoku.nim, Languages/Nim/runMe.sh, Languages/Nim/README.md</files>
  <action>
    1. Create/fix Sudoku.nim:
       - Nim has Python-like syntax, compiles to C
       - Use array[9, array[9, int]] for puzzle
       - var count: int = 0 for iterations
       - proc readMatrixFile(filename: string)
       - proc printPuzzle()
       - proc isValid(row, col, val: int): bool
       - proc solve(): bool - brute-force
         * inc(count) for every attempt
       - Use cpuTime() or epochTime() for timing

    2. Create runMe.sh:
       - LANGUAGE="Nim"
       - COMPILE_CMD="nim c -d:release -o:Sudoku Sudoku.nim"
       - SOLVER_BINARY="./Sudoku"
       - Source ../common.sh

    3. Create README.md
  </action>
  <verify>
    cd Languages/Nim && nim c -d:release Sudoku.nim && ./Sudoku ../../Matrices/1.matrix | grep "Iterations=656"
  </verify>
  <done>Nim solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 3: Implement Crystal solver</name>
  <files>Languages/Crystal/Sudoku.cr, Languages/Crystal/runMe.sh, Languages/Crystal/README.md</files>
  <action>
    1. Create/fix Sudoku.cr:
       - Crystal has Ruby-like syntax, compiles to native
       - Use Array(Array(Int32)) for puzzle
       - @count instance variable or class variable
       - def read_matrix_file(filename)
       - def print_puzzle
       - def is_valid(row, col, val)
       - def solve : Bool - brute-force
         * @count += 1 for every attempt
       - Use Time.monotonic for timing

    2. Create runMe.sh:
       - LANGUAGE="Crystal"
       - COMPILE_CMD="crystal build --release -o Sudoku Sudoku.cr"
       - SOLVER_BINARY="./Sudoku"
       - Source ../common.sh

    3. Create README.md
  </action>
  <verify>
    cd Languages/Crystal && crystal build Sudoku.cr && ./Sudoku ../../Matrices/1.matrix | grep "Iterations=656"
  </verify>
  <done>Crystal solver matches C reference for Matrix 1</done>
</task>

<task type="auto">
  <name>Task 4: Validate all three on all matrices</name>
  <files>Languages/D/metrics.json, Languages/Nim/metrics.json, Languages/Crystal/metrics.json</files>
  <action>
    1. Run each solver on all 5 matrices:
       cd Languages/D && ./runMe.sh ../../Matrices/{1,2,3,4,5}.matrix
       cd Languages/Nim && ./runMe.sh ../../Matrices/{1,2,3,4,5}.matrix
       cd Languages/Crystal && ./runMe.sh ../../Matrices/{1,2,3,4,5}.matrix

    2. Verify iteration counts for each:
       - Matrix 1: 656
       - Matrix 2: 439,269
       - Matrix 3: 98,847
       - Matrix 4: 9,085
       - Matrix 5: 445,778

    3. Update each README.md with validation results

    4. Debug any mismatches (check algorithm order)
  </action>
  <verify>
    for lang in D Nim Crystal; do echo "=== $lang ===" && grep -o '"iterations": [0-9]*' Languages/$lang/metrics.json | head -5; done
  </verify>
  <done>All three languages validated with exact iteration counts on all 5 matrices</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] D solver matches C output format and all 5 iteration counts
- [ ] Nim solver matches C output format and all 5 iteration counts
- [ ] Crystal solver matches C output format and all 5 iteration counts
- [ ] All metrics.json files populated
- [ ] All README.md files document validation status
- [ ] All runMe.sh scripts follow common.sh pattern
</verification>

<success_criteria>
- D, Nim, Crystal fully validated on all 5 matrices
- All use common.sh benchmark pattern
- Performance captured in metrics
- Documentation complete
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-tier2-languages/05.1-02-SUMMARY.md`
</output>
