---
phase: 06-core-performance-charts
plan: 01
type: execute
depends_on: []
files_modified: [Metrics/report_client.js, Metrics/HTMLGenerator.ts]
---

<objective>
Add algorithm comparison and language performance visualization charts to the benchmark report.

Purpose: Enable visual comparison of algorithmic efficiency (BruteForce vs DLX vs CP) and language performance within each algorithm type.
Output: Two new interactive D3 charts integrated into the report's chart selector.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/references/checkpoints.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-algorithm-selector-ui/05-01-SUMMARY.md

**Tech stack available:**
- D3.js v7 (already loaded via CDN in HTMLGenerator.ts line 463)
- Existing chart infrastructure: switchChart(), drawLineChart(), drawJockeyChart(), drawMatrixRace()
- Algorithm filtering: data includes algorithmType field, cMetricsByAlgorithm Map available

**Established patterns:**
- Chart functions: Named drawXxxChart(), use d3.select("#d3-chart-container"), clean container before drawing
- Styling: Neon colors (#00ff9d primary, #ff4444 errors), dark background (#16161e), monospace fonts
- Data access: Global `data` array with metrics, `currentAlgorithm` filter state
- Chart selector: Update via case statement in switchChart(), add option to dropdown in HTMLGenerator.ts

**Key files:**
- Metrics/report_client.js (2087-2760): switchChart() and chart drawing functions
- Metrics/HTMLGenerator.ts (1069-1073): Chart selector dropdown definition

**Constraining decisions:**
- Phase 5: Algorithm-specific C baselines ensure each algorithm type compares against its own standard
- Phase 5: Client-side filtering enables instant algorithm switching without regeneration
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Algorithm Comparison Chart</name>
  <files>Metrics/report_client.js</files>
  <action>
Create drawAlgorithmComparisonChart() function in report_client.js after the existing chart functions (around line 2760).

**Chart design:**
- Bar chart comparing BruteForce, DLX, CP across 3 metrics: avg time, avg iterations, efficiency ratio
- X-axis: Algorithm types (BruteForce, DLX, CP)
- Y-axis: Log scale for values (times/iterations vary by orders of magnitude)
- Three grouped bars per algorithm (time in #00ff9d, iterations in #00d4ff, efficiency in #ff9d00)
- Display actual values on top of bars
- Title: "Algorithm Comparison - [Current Matrix or All Matrices]"
- Legend explaining metrics
- Use neon styling consistent with existing charts

**Implementation:**
- Filter data by currentAlgorithm if set, otherwise show all
- Calculate averages across matrices for each algorithm type
- Use d3.scaleBand() for X-axis (algorithm types), d3.scaleLog() for Y-axis
- Add hover tooltips showing exact values
- Handle edge case: if only one algorithm type has data, show single group

**Why this approach:** Grouped bar chart is the clearest way to compare multiple metrics across categories. Log scale is necessary because iteration counts and times can differ by 10-100x between algorithms (DLX: 43 iter, BruteForce: 656 iter on Matrix 1).

**Avoid:** Linear Y-scale (will compress smaller values), pie charts (poor for numerical comparison), stacked bars (harder to compare individual metrics).
  </action>
  <verify>
- Function drawAlgorithmComparisonChart() exists in report_client.js
- No syntax errors: open _report.html in browser console shows no errors
- Chart renders when called directly: window.switchChart('algorithm') in console
  </verify>
  <done>
- Function defined with proper D3 structure (select container, create SVG, scales, axes, bars, legend)
- Uses existing neon color scheme
- Handles data filtering by algorithm type
- Log scale implemented for Y-axis
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Language Performance Chart</name>
  <files>Metrics/report_client.js</files>
  <action>
Create drawLanguagePerformanceChart() function in report_client.js after drawAlgorithmComparisonChart().

**Chart design:**
- Horizontal bar chart ranking languages by performance within selected algorithm type
- Y-axis: Language names (top 15 performers, or all if <15 with data)
- X-axis: Average time in seconds (log scale)
- Bar color: Gradient based on performance (#00ff9d for fastest â†’ #ff4444 for slowest)
- Show C baseline comparison: vertical line marking C standard, display delta % on each bar
- Title: "Top Languages - [Algorithm Type]" (e.g., "Top Languages - BruteForce")
- Filter by currentAlgorithm - show only languages with results for that algorithm type
- Display algorithm badge (DLX/CP) if applicable

**Implementation:**
- Filter data by currentAlgorithm (default to 'BruteForce' if not set)
- Calculate average time across all matrices for each language
- Sort by performance (fastest first)
- Limit to top 15 for readability
- Get C baseline from cMetricsByAlgorithm Map for current algorithm
- Calculate delta % from C baseline for each language
- Use d3.scaleBand() for Y-axis (languages), d3.scaleLog() for X-axis (time)
- Add C baseline reference line with label
- Color bars with d3.interpolateRdYlGn() inverted (green=fast, red=slow)
- Hover tooltips: language name, avg time, delta % from C, matrix coverage

**Why this approach:** Horizontal bars are ideal for ranking with text labels. Showing delta from C baseline provides context (2x slower vs 10x slower). Algorithm-specific filtering ensures fair comparison (don't compare DLX/Python to BruteForce/C).

**Avoid:** Vertical bars (language names don't fit), absolute sorting without C context (loses "how close to optimal" perspective), mixing algorithm types (unfair comparisons).
  </action>
  <verify>
- Function drawLanguagePerformanceChart() exists in report_client.js
- No syntax errors: browser console shows no errors
- Chart renders when called: window.switchChart('language') in console
- Filters correctly: changing algorithm selector updates chart data
  </verify>
  <done>
- Function defined with D3 horizontal bar structure
- Filters data by currentAlgorithm
- Shows C baseline reference line
- Displays delta % from C on bars
- Color gradient applied based on performance
- Hover tooltips functional
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate charts into selector</name>
  <files>Metrics/report_client.js, Metrics/HTMLGenerator.ts</files>
  <action>
**In report_client.js (switchChart function, around line 2087):**
Add two new case statements to handle the new chart types:
```javascript
} else if (type === 'algorithm') {
    drawAlgorithmComparisonChart();
} else if (type === 'language') {
    drawLanguagePerformanceChart();
}
```
Place these after the existing 'race' case (line 2122) and before the closing brace.

**In Metrics/HTMLGenerator.ts (chart selector dropdown, line 1069-1073):**
Add two new options to the select element:
```html
<option value="algorithm">Algorithm Comparison</option>
<option value="language">Top Languages</option>
```
Insert after line 1072 (race option), before the closing </select> tag.

**Why this approach:** Follows established pattern for chart integration. No changes to chart infrastructure needed - just extend the existing switch statement and dropdown options.

**Avoid:** Creating separate selector UI (inconsistent), modifying switchChart() logic beyond adding cases (unnecessary complexity), changing option order that breaks user expectations (existing charts should stay first).
  </action>
  <verify>
- Dropdown shows 5 options: Metrics, Horse Race, Matrix Race, Algorithm Comparison, Top Languages
- Selecting "Algorithm Comparison" renders algorithm chart
- Selecting "Top Languages" renders language performance chart
- No console errors when switching between all 5 chart types
- Algorithm selector filtering works with new charts
  </verify>
  <done>
- switchChart() handles 'algorithm' and 'language' cases
- HTMLGenerator.ts dropdown includes new options
- All 5 charts switchable via dropdown
- Algorithm filtering applies to new charts
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Two new performance visualization charts integrated into the benchmark report</what-built>
  <how-to-verify>
1. Generate fresh report: `cd Metrics && npx ts-node generate_report_only.ts`
2. Open: `open ../_report.html` (or view in browser)
3. Test Algorithm Comparison chart:
   - Select "Algorithm Comparison" from chart dropdown
   - Verify: Bars for BruteForce, DLX, CP visible with grouped metrics
   - Verify: Log scale shows both small (DLX: 43) and large (BruteForce: 656) values clearly
   - Verify: Legend explains metrics (time, iterations, efficiency)
   - Verify: Neon styling consistent with existing charts
4. Test Top Languages chart:
   - Select "Top Languages" from chart dropdown
   - Verify: Horizontal bars showing top 15 languages (or fewer if limited data)
   - Verify: C baseline reference line visible
   - Verify: Delta % from C displayed on bars
   - Verify: Color gradient (green=fast, red=slow)
5. Test algorithm filtering integration:
   - Change algorithm selector from "All" to "BruteForce"
   - Verify: Top Languages chart updates to show only BruteForce implementations
   - Switch to "DLX"
   - Verify: Chart updates to DLX implementations, C baseline changes to DLX/C value
   - Switch to "CP"
   - Verify: Chart updates to CP implementations
6. Test chart switching:
   - Cycle through all 5 chart types (Metrics, Horse Race, Matrix Race, Algorithm Comparison, Top Languages)
   - Verify: No console errors, smooth transitions, no visual glitches
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both chart functions exist in report_client.js
- [ ] Chart selector dropdown includes new options
- [ ] switchChart() handles new cases
- [ ] Charts render without errors
- [ ] Algorithm filtering works with new charts
- [ ] Visual styling matches existing charts (neon theme, dark background)
- [ ] All 5 charts switchable via dropdown
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Two new charts functional and integrated
- Algorithm selector filtering applies to new charts
- No errors or warnings introduced
- User approval on checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/06-core-performance-charts/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Algorithm & Language Comparison Charts Summary

**[Substantive one-liner - what was built]**

## Accomplishments

- Algorithm Comparison chart comparing BruteForce, DLX, CP across metrics
- Top Languages chart ranking performance within algorithm types
- C baseline integration with delta % display
- Chart selector integration with 5 total chart types

## Files Created/Modified

- `Metrics/report_client.js` - Added drawAlgorithmComparisonChart(), drawLanguagePerformanceChart(), switchChart() cases
- `Metrics/HTMLGenerator.ts` - Updated chart selector with 2 new options

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 06-02-PLAN.md (Iteration Analysis & Integration)
</output>
