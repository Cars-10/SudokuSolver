---
phase: 19-language-metadata-and-display-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [Metrics/HTMLGenerator.ts, Metrics/report_client.js]
autonomous: true
---

<objective>
Fix language count display and remove unnecessary computer icon badge.

Purpose: Restore accurate language count display in UI and remove visual noise from the computer icon badge that appears for all non-Docker/AI runs.
Output: Correct language count shown in UI, no computer icon (ğŸ’») badge in results table.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@Metrics/HTMLGenerator.ts
@server/public/report_client.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix language count display logic</name>
  <files>Metrics/report_client.js, Metrics/HTMLGenerator.ts</files>
  <action>
Fix the language count display issue that shows incorrect or undefined values.

Root cause: `planned` variable is referenced in report_client.js (line 1631) but not defined in JavaScript scope.

Solution approach:
1. In HTMLGenerator.ts (line 298), the `totalPlanned` variable is calculated but not passed to the client-side JavaScript
2. Option A: Pass `totalPlanned` to the client-side via a data attribute or inline script variable
3. Option B: Calculate language count directly in client-side JavaScript from available `metricsData` array
4. Option C (recommended): Remove the fallback to `planned` entirely and always use the actual metrics count

In report_client.js (lines 1627-1631), change:
```javascript
if (screensaverText && typeof metricsData !== 'undefined' && metricsData.length > 0) {
    screensaverText.innerText = `${metricsData.length} LANGUAGES`;
} else if (screensaverText) {
    screensaverText.innerText = `${planned} LANGUAGES`;  // â† planned is undefined
}
```

To:
```javascript
if (screensaverText && typeof metricsData !== 'undefined' && metricsData.length > 0) {
    screensaverText.innerText = `${metricsData.length} LANGUAGES`;
} else if (screensaverText) {
    screensaverText.innerText = `LOADING...`;  // Fallback when data not yet loaded
}
```

Also ensure the language selector button (HTMLGenerator.ts line 1141) updates dynamically when algorithm filter changes. This may require adding an update function in report_client.js that's called whenever the visible metrics change.

Do NOT hardcode language counts - always derive from the actual filtered metrics.
  </action>
  <verify>
1. Grep for undefined variables: grep -n "planned" Metrics/report_client.js
2. Regenerate report: cd Metrics && npx ts-node generate_report_only.ts
3. Check report_client.js has no references to undefined `planned`
4. Start server and verify count displays correctly: cd server && npm start
  </verify>
  <done>Language count displays correct value based on visible filtered metrics, no undefined variable references</done>
</task>

<task type="auto">
  <name>Task 2: Remove computer icon badge</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
Remove the computer icon (ğŸ’») badge that appears for all local runs.

Location: HTMLGenerator.ts lines 1336-1343

Current logic:
```typescript
let typeIcon = '';
if (runType === 'Docker') {
    typeIcon = '<span title="Docker Container" style="margin-left:5px; font-size: 0.8em;">ğŸ³</span>';
} else if (runType === 'AI') {
    typeIcon = '<span class="ai-tag" title="AI Generated">(AI)</span>';
} else {
    typeIcon = '<span title="Local Run" style="margin-left:5px; font-size: 0.8em;">ğŸ’»</span>';  // â† Remove this
}
```

Change the `else` clause to an empty string:
```typescript
let typeIcon = '';
if (runType === 'Docker') {
    typeIcon = '<span title="Docker Container" style="margin-left:5px; font-size: 0.8em;">ğŸ³</span>';
} else if (runType === 'AI') {
    typeIcon = '<span class="ai-tag" title="AI Generated">(AI)</span>';
}
// Remove else clause entirely - no badge for standard local runs
```

This keeps the Docker (ğŸ³) and AI badges which provide meaningful differentiation, but removes the computer icon that appears for the majority of runs and adds visual noise.

The `typeIcon` variable is inserted at line 1410 in the table row: `${displayName}${algoBadge}${typeIcon}`
  </action>
  <verify>
1. TypeScript compilation: npx tsc --noEmit
2. Grep for computer icon: grep -n "ğŸ’»" Metrics/HTMLGenerator.ts (should find no results after change)
3. Regenerate report: cd Metrics && npx ts-node generate_report_only.ts
4. Manually inspect _report.html - no ğŸ’» icons should appear in results table
  </verify>
  <done>Computer icon badge removed, only Docker (ğŸ³) and AI badges remain</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npx tsc --noEmit passes
- [ ] Report generation succeeds (cd Metrics && npx ts-node generate_report_only.ts)
- [ ] Language count displays correctly in generated report
- [ ] No computer icon (ğŸ’») badges appear in results table
- [ ] Docker (ğŸ³) and AI badges still present where applicable
</verification>

<success_criteria>

- All tasks completed
- Language count accurate and no undefined variables
- Computer icon badge removed
- Report generates without errors
- No visual regressions in other UI elements
  </success_criteria>

<output>
After completion, create `.planning/phases/19-language-metadata-and-display-fixes/19-02-SUMMARY.md`
</output>
