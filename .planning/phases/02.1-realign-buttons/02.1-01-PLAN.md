---
phase: 02.1-realign-buttons
plan: 01
type: execute
---

<objective>
Reorganize the button bar above the benchmark table for cleaner UI.

Purpose: Improve visual hierarchy by consolidating info-related buttons into a dropdown and cleaning up the control bar.
Output: Streamlined button bar with Info dropdown, working sort buttons, and random persona selection on load.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key files:**
@Metrics/HTMLGenerator.ts - Main HTML generation (lines 1354-1426 contain .controls buttons)
@Metrics/index.css - Styling for .top-bar, .controls, .dropdown
@Metrics/report_client.js - Client-side JS for button handlers and persona selection

**Current button structure (lines ~1374-1422 in HTMLGenerator.ts):**
- Personality selector dropdown
- Methodology button
- Name sort button
- Time sort button
- Memory sort button
- Entropy sort button (TO BE REMOVED)
- Score sort button
- Show Mismatches toggle
- Project Goals button
- Why??? button
- Languages dropdown

**Changes required:**
1. Create "Info" dropdown containing: Methodology, Project Goals, Why???
2. Remove Entropy button entirely
3. Add random persona selection on page load
4. Maintain sorting functionality for Name, Time, Memory, Score
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Info dropdown and restructure buttons</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
    In the .controls section (around line 1374-1422):

    1. Remove the standalone buttons:
       - `<button class="btn" onclick="showMethodology()">Methodology</button>`
       - `<button class="btn" onclick="showGoals()">Project Goals</button>`
       - `<button class="btn" onclick="showWhy()">Why???</button>`

    2. Remove the Entropy button:
       - `<button class="btn" onclick="sortRows('iters', this)">Entropy</button>`

    3. Add a new "Info" dropdown after the Score button, using the existing dropdown pattern:
       ```html
       <div class="dropdown">
           <button class="btn">Info ▾</button>
           <div class="dropdown-content">
               <a onclick="showMethodology()">Methodology</a>
               <a onclick="showGoals()">Project Goals</a>
               <a onclick="showWhy()">Why???</a>
           </div>
       </div>
       ```

    Final button order should be:
    - Personality selector
    - Name (sort)
    - Time (sort)
    - Memory (sort)
    - Score (sort)
    - Show Mismatches (toggle)
    - Info (dropdown with Methodology, Project Goals, Why???)
    - Languages (dropdown)
  </action>
  <verify>Search HTMLGenerator.ts for "Entropy" - should return no results. Search for "Info ▾" - should find the new dropdown.</verify>
  <done>Info dropdown exists with 3 items, Entropy button removed, button order matches spec.</done>
</task>

<task type="auto">
  <name>Task 2: Verify sorting buttons still work</name>
  <files>Metrics/HTMLGenerator.ts, Metrics/report_client.js</files>
  <action>
    Verify that the remaining sort buttons are properly wired:

    1. In HTMLGenerator.ts, confirm these buttons exist with correct onclick handlers:
       - `onclick="sortRows('lang', this)"` for Name
       - `onclick="sortRows('time', this)"` for Time
       - `onclick="sortRows('mem', this)"` for Memory
       - `onclick="sortRows('score', this)"` for Score

    2. In report_client.js, verify the `sortRows()` function handles all these sort types:
       - 'lang' - alphabetical by language name
       - 'time' - by total execution time
       - 'mem' - by memory usage
       - 'score' - by composite score

    No code changes needed if already working - just verification.
  </action>
  <verify>Read HTMLGenerator.ts and confirm all 4 sort buttons have correct onclick handlers.</verify>
  <done>All sort buttons (Name, Time, Memory, Score) have correct handlers and sortRows() supports all types.</done>
</task>

<task type="auto">
  <name>Task 3: Add random persona selection on page load</name>
  <files>Metrics/HTMLGenerator.ts</files>
  <action>
    Add JavaScript to select a random persona when the page loads.

    In the inline script section (around line 1092 or in the DOMContentLoaded handler):

    1. Get the persona options from the personality-selector dropdown
    2. Filter to only valid persona values (exclude the disabled "PERSONA" placeholder)
    3. Select one at random
    4. Set the dropdown value and trigger the changePersonality() function

    Add this code in the DOMContentLoaded event handler:
    ```javascript
    // Random persona selection on load
    const personaSelector = document.getElementById('personality-selector');
    if (personaSelector) {
        const options = Array.from(personaSelector.options).filter(o => !o.disabled && o.value);
        if (options.length > 0) {
            const randomIndex = Math.floor(Math.random() * options.length);
            personaSelector.value = options[randomIndex].value;
            if (typeof changePersonality === 'function') {
                changePersonality();
            }
        }
    }
    ```

    Place this after the riddleSystem initialization in the DOMContentLoaded handler (around line 1291-1293).
  </action>
  <verify>Search for "Random persona" comment in HTMLGenerator.ts output. Verify the code is in DOMContentLoaded.</verify>
  <done>Random persona is selected on page load, dropdown shows selected value, intro text reflects the persona.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Restructured button bar with Info dropdown, removed Entropy, added random persona selection</what-built>
  <how-to-verify>
    1. Generate the report: `cd /Users/vibe/ClaudeCode/SudokuSolver && npx tsx Metrics/generate_report_only.ts`
    2. Open the generated HTML report in browser
    3. Verify button bar layout:
       - Buttons should be: Persona dropdown, Name, Time, Memory, Score, Show Mismatches, Info dropdown, Languages dropdown
       - NO Entropy button should be visible
    4. Test Info dropdown:
       - Hover over "Info ▾" button
       - Should show: Methodology, Project Goals, Why???
       - Click each item - modal should open
    5. Test sorting:
       - Click Name - rows sort alphabetically
       - Click Time - rows sort by execution time (fastest first)
       - Click Memory - rows sort by memory usage
       - Click Score - rows sort by composite score
    6. Test random persona:
       - Refresh the page several times
       - Persona dropdown should show different random selections
       - Intro text should match the selected persona style
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] No "Entropy" button in the generated HTML
- [ ] Info dropdown contains Methodology, Project Goals, Why???
- [ ] All sort buttons functional (Name, Time, Memory, Score)
- [ ] Random persona selected on each page load
- [ ] No console errors
- [ ] Report generates without errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Button bar is cleaner and properly aligned
- Info dropdown works with hover interaction
- Sorting functionality preserved
- Random persona selection works on page load
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-realign-buttons/02.1-01-SUMMARY.md`
</output>
