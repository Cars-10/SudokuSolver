description = "Initialize a new project with deep context gathering and PROJECT.md"
prompt = "<objective>\n\nInitialize a new project through comprehensive context gathering.\n\nThis is the most leveraged moment in any project. Deep questioning here means better plans, better execution, better outcomes.\n\nCreates `.planning/` with PROJECT.md and config.json.\n\n</objective>\n\n<execution_context>\n\n@./.gemini/get-shit-done/references/principles.md\n@./.gemini/get-shit-done/references/questioning.md\n@./.gemini/get-shit-done/templates/project.md\n@./.gemini/get-shit-done/templates/config.json\n\n</execution_context>\n\n<process>\n\n<step name=\"setup\">\n\n**MANDATORY FIRST STEP — Execute these checks before ANY user interaction:**\n\n1. **Abort if project exists:**\n   ```bash\n   [ -f .planning/PROJECT.md ] && echo \"ERROR: Project already initialized. Use /gsd:progress\" && exit 1\n   ```\n\n2. **Initialize git repo in THIS directory** (required even if inside a parent repo):\n   ```bash\n   # Check if THIS directory is already a git repo root (handles .git file for worktrees too)\n   if [ -d .git ] || [ -f .git ]; then\n       echo \"Git repo exists in current directory\"\n   else\n       git init\n       echo \"Initialized new git repo\"\n   fi\n   ```\n\n3. **Detect existing code (brownfield detection):**\n   ```bash\n   # Check for existing code files\n   CODE_FILES=$(find . -name \"*.ts\" -o -name \"*.js\" -o -name \"*.py\" -o -name \"*.go\" -o -name \"*.rs\" -o -name \"*.swift\" -o -name \"*.java\" 2>/dev/null | grep -v node_modules | grep -v .git | head -20)\n   HAS_PACKAGE=$([ -f package.json ] || [ -f requirements.txt ] || [ -f Cargo.toml ] || [ -f go.mod ] || [ -f Package.swift ] && echo \"yes\")\n   HAS_CODEBASE_MAP=$([ -d .planning/codebase ] && echo \"yes\")\n   ```\n\n   **You MUST run all bash commands above using the Bash tool before proceeding.**\n\n</step>\n\n<step name=\"brownfield_offer\">\n\n**If existing code detected and .planning/codebase/ doesn't exist:**\n\nCheck the results from setup step:\n- If `CODE_FILES` is non-empty OR `HAS_PACKAGE` is \"yes\"\n- AND `HAS_CODEBASE_MAP` is NOT \"yes\"\n\nUse AskUserQuestion:\n- header: \"Existing Code\"\n- question: \"I detected existing code in this directory. Would you like to map the codebase first?\"\n- options:\n  - \"Map codebase first\" — Run /gsd:map-codebase to understand existing architecture (Recommended)\n  - \"Skip mapping\" — Proceed with project initialization\n\n**If \"Map codebase first\":**\n```\nRun `/gsd:map-codebase` first, then return to `/gsd:new-project`\n```\nExit command.\n\n**If \"Skip mapping\":** Continue to question step.\n\n**If no existing code detected OR codebase already mapped:** Continue to question step.\n\n</step>\n\n<step name=\"question\">\n\n**1. Open (FREEFORM — do NOT use AskUserQuestion):**\n\nAsk inline: \"What do you want to build?\"\n\nWait for their freeform response. This gives you the context needed to ask intelligent follow-up questions.\n\n**2. Follow the thread (NOW use AskUserQuestion):**\n\nBased on their response, use AskUserQuestion with options that probe what they mentioned:\n- header: \"[Topic they mentioned]\"\n- question: \"You mentioned [X] — what would that look like?\"\n- options: 2-3 interpretations + \"Something else\"\n\n**3. Sharpen the core:**\n\nUse AskUserQuestion:\n- header: \"Core\"\n- question: \"If you could only nail one thing, what would it be?\"\n- options: Key aspects they've mentioned + \"All equally important\" + \"Something else\"\n\n**4. Find boundaries:**\n\nUse AskUserQuestion:\n- header: \"Scope\"\n- question: \"What's explicitly NOT in v1?\"\n- options: Things that might be tempting + \"Nothing specific\" + \"Let me list them\"\n\n**5. Ground in reality:**\n\nUse AskUserQuestion:\n- header: \"Constraints\"\n- question: \"Any hard constraints?\"\n- options: Relevant constraint types + \"None\" + \"Yes, let me explain\"\n\n**6. Decision gate:**\n\nUse AskUserQuestion:\n- header: \"Ready?\"\n- question: \"Ready to create PROJECT.md, or explore more?\"\n- options (ALL THREE REQUIRED):\n  - \"Create PROJECT.md\" — Finalize and continue\n  - \"Ask more questions\" — I'll dig deeper\n  - \"Let me add context\" — You have more to share\n\nIf \"Ask more questions\" → check coverage gaps from `questioning.md` → return to step 2.\nIf \"Let me add context\" → receive input via their response → return to step 2.\nLoop until \"Create PROJECT.md\" selected.\n\n</step>\n\n<step name=\"project\">\n\nSynthesize all context into `.planning/PROJECT.md` using the template from `templates/project.md`.\n\n**For greenfield projects:**\n\nInitialize requirements as hypotheses:\n\n```markdown\n## Requirements\n\n### Validated\n\n(None yet — ship to validate)\n\n### Active\n\n- [ ] [Requirement 1]\n- [ ] [Requirement 2]\n- [ ] [Requirement 3]\n\n### Out of Scope\n\n- [Exclusion 1] — [why]\n- [Exclusion 2] — [why]\n```\n\nAll Active requirements are hypotheses until shipped and validated.\n\n**For brownfield projects (codebase map exists):**\n\nInfer Validated requirements from existing code:\n\n1. Read `.planning/codebase/ARCHITECTURE.md` and `STACK.md`\n2. Identify what the codebase already does\n3. These become the initial Validated set\n\n```markdown\n## Requirements\n\n### Validated\n\n- ✓ [Existing capability 1] — existing\n- ✓ [Existing capability 2] — existing\n- ✓ [Existing capability 3] — existing\n\n### Active\n\n- [ ] [New requirement 1]\n- [ ] [New requirement 2]\n\n### Out of Scope\n\n- [Exclusion 1] — [why]\n```\n\n**Key Decisions:**\n\nInitialize with any decisions made during questioning:\n\n```markdown\n## Key Decisions\n\n| Decision | Rationale | Outcome |\n|----------|-----------|---------|\n| [Choice from questioning] | [Why] | — Pending |\n```\n\n**Last updated footer:**\n\n```markdown\n---\n*Last updated: [date] after initialization*\n```\n\nDo not compress. Capture everything gathered.\n\n</step>\n\n<step name=\"mode\">\n\nAsk workflow mode preference:\n\nUse AskUserQuestion:\n\n- header: \"Mode\"\n- question: \"How do you want to work?\"\n- options:\n  - \"Interactive\" — Confirm at each step\n  - \"YOLO\" — Auto-approve, just execute\n\n</step>\n\n<step name=\"depth\">\n\nAsk planning depth preference:\n\nUse AskUserQuestion:\n\n- header: \"Depth\"\n- question: \"How thorough should planning be?\"\n- options:\n  - \"Quick\" — Ship fast, minimal phases/plans (3-5 phases, 1-3 plans each)\n  - \"Standard\" — Balanced scope and speed (5-8 phases, 3-5 plans each)\n  - \"Comprehensive\" — Thorough coverage, more phases/plans (8-12 phases, 5-10 plans each)\n\n**Depth controls compression tolerance, not artificial inflation.** All depths use 2-3 tasks per plan. Comprehensive means \"don't compress complex work\"—it doesn't mean \"pad simple work to hit a number.\"\n\n</step>\n\n<step name=\"parallelization\">\n\nAsk parallel execution preference:\n\nUse AskUserQuestion:\n\n- header: \"Parallelization\"\n- question: \"Enable parallel phase execution?\"\n- options:\n  - \"Enabled\" — Run independent plans in parallel (Recommended)\n  - \"Disabled\" — Execute plans sequentially\n\n**Parallelization allows `/gsd:execute-phase` to spawn multiple agents for independent plans.** Useful for \"walk away, come back to completed work\" execution. Can be changed later in config.json.\n\n</step>\n\n<step name=\"config\">\n\nCreate `.planning/config.json` with chosen mode, depth, and parallelization using `templates/config.json` structure.\n\n</step>\n\n<step name=\"commit\">\n\n```bash\ngit add .planning/PROJECT.md .planning/config.json\ngit commit -m \"$(cat <<'EOF'\ndocs: initialize [project-name]\n\n[One-liner from PROJECT.md]\n\nCreates PROJECT.md with requirements and constraints.\nEOF\n)\"\n```\n\n</step>\n\n<step name=\"done\">\n\nPresent completion with next steps (see ./.gemini/get-shit-done/references/continuation-format.md):\n\n```\nProject initialized:\n\n- Project: .planning/PROJECT.md\n- Config: .planning/config.json (mode: [chosen mode])\n[If .planning/codebase/ exists:] - Codebase: .planning/codebase/ (7 documents)\n\n---\n\n## ▶ Next Up\n\n**[Project Name]** — create roadmap\n\n`/gsd:create-roadmap`\n\n<sub>`/clear` first → fresh context window</sub>\n\n---\n```\n\n</step>\n\n</process>\n\n<output>\n\n- `.planning/PROJECT.md`\n- `.planning/config.json`\n\n</output>\n\n<success_criteria>\n\n- [ ] Deep questioning completed (not rushed)\n- [ ] PROJECT.md captures full context with evolutionary structure\n- [ ] Requirements initialized as hypotheses (greenfield) or with inferred Validated (brownfield)\n- [ ] Key Decisions table initialized\n- [ ] config.json has workflow mode, depth, and parallelization\n- [ ] All committed to git\n\n</success_criteria>"
