description = "Remove a future phase from roadmap and renumber subsequent phases"
prompt = "<objective>\nRemove an unstarted future phase from the roadmap and renumber all subsequent phases to maintain a clean, linear sequence.\n\nPurpose: Clean removal of work you've decided not to do, without polluting context with cancelled/deferred markers.\nOutput: Phase deleted, all subsequent phases renumbered, git commit as historical record.\n</objective>\n\n<execution_context>\n@.planning/ROADMAP.md\n@.planning/STATE.md\n</execution_context>\n\n<process>\n\n<step name=\"parse_arguments\">\nParse the command arguments:\n- Argument is the phase number to remove (integer or decimal)\n- Example: `/gsd:remove-phase 17` → phase = 17\n- Example: `/gsd:remove-phase 16.1` → phase = 16.1\n\nIf no argument provided:\n\n```\nERROR: Phase number required\nUsage: /gsd:remove-phase <phase-number>\nExample: /gsd:remove-phase 17\n```\n\nExit.\n</step>\n\n<step name=\"load_state\">\nLoad project state:\n\n```bash\ncat .planning/STATE.md 2>/dev/null\ncat .planning/ROADMAP.md 2>/dev/null\n```\n\nParse current phase number from STATE.md \"Current Position\" section.\n</step>\n\n<step name=\"validate_phase_exists\">\nVerify the target phase exists in ROADMAP.md:\n\n1. Search for `### Phase {target}:` heading\n2. If not found:\n\n   ```\n   ERROR: Phase {target} not found in roadmap\n   Available phases: [list phase numbers]\n   ```\n\n   Exit.\n</step>\n\n<step name=\"validate_future_phase\">\nVerify the phase is a future phase (not started):\n\n1. Compare target phase to current phase from STATE.md\n2. Target must be > current phase number\n\nIf target <= current phase:\n\n```\nERROR: Cannot remove Phase {target}\n\nOnly future phases can be removed:\n- Current phase: {current}\n- Phase {target} is current or completed\n\nTo abandon current work, use /gsd:pause-work instead.\n```\n\nExit.\n\n3. Check for SUMMARY.md files in phase directory:\n\n```bash\nls .planning/phases/{target}-*/*-SUMMARY.md 2>/dev/null\n```\n\nIf any SUMMARY.md files exist:\n\n```\nERROR: Phase {target} has completed work\n\nFound executed plans:\n- {list of SUMMARY.md files}\n\nCannot remove phases with completed work.\n```\n\nExit.\n</step>\n\n<step name=\"gather_phase_info\">\nCollect information about the phase being removed:\n\n1. Extract phase name from ROADMAP.md heading: `### Phase {target}: {Name}`\n2. Find phase directory: `.planning/phases/{target}-{slug}/`\n3. Find all subsequent phases (integer and decimal) that need renumbering\n\n**Subsequent phase detection:**\n\nFor integer phase removal (e.g., 17):\n- Find all phases > 17 (integers: 18, 19, 20...)\n- Find all decimal phases >= 17.0 and < 18.0 (17.1, 17.2...) → these become 16.x\n- Find all decimal phases for subsequent integers (18.1, 19.1...) → renumber with their parent\n\nFor decimal phase removal (e.g., 17.1):\n- Find all decimal phases > 17.1 and < 18 (17.2, 17.3...) → renumber down\n- Integer phases unchanged\n\nList all phases that will be renumbered.\n</step>\n\n<step name=\"confirm_removal\">\nPresent removal summary and confirm:\n\n```\nRemoving Phase {target}: {Name}\n\nThis will:\n- Delete: .planning/phases/{target}-{slug}/\n- Renumber {N} subsequent phases:\n  - Phase 18 → Phase 17\n  - Phase 18.1 → Phase 17.1\n  - Phase 19 → Phase 18\n  [etc.]\n\nProceed? (y/n)\n```\n\nWait for confirmation.\n</step>\n\n<step name=\"delete_phase_directory\">\nDelete the target phase directory if it exists:\n\n```bash\nif [ -d \".planning/phases/{target}-{slug}\" ]; then\n  rm -rf \".planning/phases/{target}-{slug}\"\n  echo \"Deleted: .planning/phases/{target}-{slug}/\"\nfi\n```\n\nIf directory doesn't exist, note: \"No directory to delete (phase not yet created)\"\n</step>\n\n<step name=\"renumber_directories\">\nRename all subsequent phase directories:\n\nFor each phase directory that needs renumbering (in reverse order to avoid conflicts):\n\n```bash\n# Example: renaming 18-dashboard to 17-dashboard\nmv \".planning/phases/18-dashboard\" \".planning/phases/17-dashboard\"\n```\n\nProcess in descending order (20→19, then 19→18, then 18→17) to avoid overwriting.\n\nAlso rename decimal phase directories:\n- `17.1-fix-bug` → `16.1-fix-bug` (if removing integer 17)\n- `17.2-hotfix` → `17.1-hotfix` (if removing decimal 17.1)\n</step>\n\n<step name=\"rename_files_in_directories\">\nRename plan files inside renumbered directories:\n\nFor each renumbered directory, rename files that contain the phase number:\n\n```bash\n# Inside 17-dashboard (was 18-dashboard):\nmv \"18-01-PLAN.md\" \"17-01-PLAN.md\"\nmv \"18-02-PLAN.md\" \"17-02-PLAN.md\"\nmv \"18-01-SUMMARY.md\" \"17-01-SUMMARY.md\"  # if exists\n# etc.\n```\n\nAlso handle CONTEXT.md and DISCOVERY.md (these don't have phase prefixes, so no rename needed).\n</step>\n\n<step name=\"update_roadmap\">\nUpdate ROADMAP.md:\n\n1. **Remove the phase section entirely:**\n   - Delete from `### Phase {target}:` to the next phase heading (or section end)\n\n2. **Remove from phase list:**\n   - Delete line `- [ ] **Phase {target}: {Name}**` or similar\n\n3. **Remove from Progress table:**\n   - Delete the row for Phase {target}\n\n4. **Renumber all subsequent phases:**\n   - `### Phase 18:` → `### Phase 17:`\n   - `- [ ] **Phase 18:` → `- [ ] **Phase 17:`\n   - Table rows: `| 18. Dashboard |` → `| 17. Dashboard |`\n   - Plan references: `18-01:` → `17-01:`\n\n5. **Update dependency references:**\n   - `**Depends on:** Phase 18` → `**Depends on:** Phase 17`\n   - For the phase that depended on the removed phase:\n     - `**Depends on:** Phase 17` (removed) → `**Depends on:** Phase 16`\n\n6. **Renumber decimal phases:**\n   - `### Phase 17.1:` → `### Phase 16.1:` (if integer 17 removed)\n   - Update all references consistently\n\nWrite updated ROADMAP.md.\n</step>\n\n<step name=\"update_state\">\nUpdate STATE.md:\n\n1. **Update total phase count:**\n   - `Phase: 16 of 20` → `Phase: 16 of 19`\n\n2. **Recalculate progress percentage:**\n   - New percentage based on completed plans / new total plans\n\nDo NOT add a \"Roadmap Evolution\" note - the git commit is the record.\n\nWrite updated STATE.md.\n</step>\n\n<step name=\"update_file_contents\">\nSearch for and update phase references inside plan files:\n\n```bash\n# Find files that reference the old phase numbers\ngrep -r \"Phase 18\" .planning/phases/17-*/ 2>/dev/null\ngrep -r \"Phase 19\" .planning/phases/18-*/ 2>/dev/null\n# etc.\n```\n\nUpdate any internal references to reflect new numbering.\n</step>\n\n<step name=\"commit\">\nStage and commit the removal:\n\n```bash\ngit add .planning/\ngit commit -m \"chore: remove phase {target} ({original-phase-name})\"\n```\n\nThe commit message preserves the historical record of what was removed.\n</step>\n\n<step name=\"completion\">\nPresent completion summary:\n\n```\nPhase {target} ({original-name}) removed.\n\nChanges:\n- Deleted: .planning/phases/{target}-{slug}/\n- Renumbered: Phases {first-renumbered}-{last-old} → {first-renumbered-1}-{last-new}\n- Updated: ROADMAP.md, STATE.md\n- Committed: chore: remove phase {target} ({original-name})\n\nCurrent roadmap: {total-remaining} phases\nCurrent position: Phase {current} of {new-total}\n\n---\n\n## What's Next\n\nWould you like to:\n- `/gsd:progress` — see updated roadmap status\n- Continue with current phase\n- Review roadmap\n\n---\n```\n</step>\n\n</process>\n\n<anti_patterns>\n\n- Don't remove completed phases (have SUMMARY.md files)\n- Don't remove current or past phases\n- Don't leave gaps in numbering - always renumber\n- Don't add \"removed phase\" notes to STATE.md - git commit is the record\n- Don't ask about each decimal phase - just renumber them\n- Don't modify completed phase directories\n</anti_patterns>\n\n<edge_cases>\n\n**Removing a decimal phase (e.g., 17.1):**\n- Only affects other decimals in same series (17.2 → 17.1, 17.3 → 17.2)\n- Integer phases unchanged\n- Simpler operation\n\n**No subsequent phases to renumber:**\n- Removing the last phase (e.g., Phase 20 when that's the end)\n- Just delete and update ROADMAP.md, no renumbering needed\n\n**Phase directory doesn't exist:**\n- Phase may be in ROADMAP.md but directory not created yet\n- Skip directory deletion, proceed with ROADMAP.md updates\n\n**Decimal phases under removed integer:**\n- Removing Phase 17 when 17.1, 17.2 exist\n- 17.1 → 16.1, 17.2 → 16.2\n- They maintain their position in execution order (after current last integer)\n\n</edge_cases>\n\n<success_criteria>\nPhase removal is complete when:\n\n- [ ] Target phase validated as future/unstarted\n- [ ] Phase directory deleted (if existed)\n- [ ] All subsequent phase directories renumbered\n- [ ] Files inside directories renamed ({old}-01-PLAN.md → {new}-01-PLAN.md)\n- [ ] ROADMAP.md updated (section removed, all references renumbered)\n- [ ] STATE.md updated (phase count, progress percentage)\n- [ ] Dependency references updated in subsequent phases\n- [ ] Changes committed with descriptive message\n- [ ] No gaps in phase numbering\n- [ ] User informed of changes\n</success_criteria>"
