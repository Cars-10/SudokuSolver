description = "Review deferred issues with codebase context, close resolved ones, identify urgent ones"
prompt = "<objective>\nReview all open issues from ISSUES.md with current codebase context. Identify which issues are resolved (can close), which are now urgent (should address), and which can continue waiting.\n\nThis prevents issue pile-up by providing a triage mechanism with codebase awareness.\n</objective>\n\n<context>\n@.planning/ISSUES.md\n@.planning/STATE.md\n@.planning/ROADMAP.md\n</context>\n\n<process>\n\n<step name=\"verify\">\n**Verify issues file exists:**\n\nIf no `.planning/ISSUES.md`:\n```\nNo issues file found.\n\nThis means no enhancements have been deferred yet (Rule 5 hasn't triggered).\n\nNothing to review.\n```\nExit.\n\nIf ISSUES.md exists but has no open issues (only template or empty \"Open Enhancements\"):\n```\nNo open issues to review.\n\nAll clear - continue with current work.\n```\nExit.\n</step>\n\n<step name=\"parse\">\n**Parse all open issues:**\n\nExtract from \"## Open Enhancements\" section:\n- ISS number (ISS-001, ISS-002, etc.)\n- Brief description\n- Discovered phase/date\n- Type (Performance/Refactoring/UX/Testing/Documentation/Accessibility)\n- Description details\n- Effort estimate\n\nBuild list of issues to analyze.\n</step>\n\n<step name=\"analyze\">\n**For each open issue, perform codebase analysis:**\n\n1. **Check if still relevant:**\n   - Search codebase for related code/files mentioned in issue\n   - If code no longer exists or was significantly refactored: likely resolved\n\n2. **Check if accidentally resolved:**\n   - Look for commits/changes that may have addressed this\n   - Check if the enhancement was implemented as part of other work\n\n3. **Assess current urgency:**\n   - Is this blocking upcoming phases?\n   - Has this become a pain point mentioned in recent summaries?\n   - Is this now affecting code we're actively working on?\n\n4. **Check natural fit:**\n   - Does this align with an upcoming phase in the roadmap?\n   - Would addressing it now touch the same files as current work?\n\n**Categorize each issue:**\n- **Resolved** - Can be closed (code changed, no longer applicable)\n- **Urgent** - Should address before continuing (blocking or causing problems)\n- **Natural fit** - Good candidate for upcoming phase X\n- **Can wait** - Keep deferred, no change in status\n</step>\n\n<step name=\"report\">\n**Present categorized report:**\n\n```\n# Issue Review\n\n**Analyzed:** [N] open issues\n**Last reviewed:** [today's date]\n\n## Resolved (can close)\n\n### ISS-XXX: [description]\n**Reason:** [Why it's resolved - code changed, implemented elsewhere, no longer applicable]\n**Evidence:** [What you found - file changes, missing code, etc.]\n\n[Repeat for each resolved issue, or \"None\" if none resolved]\n\n---\n\n## Urgent (should address now)\n\n### ISS-XXX: [description]\n**Why urgent:** [What changed - blocking next phase, causing active problems, etc.]\n**Recommendation:** Insert plan before Phase [X] / Add to current phase\n**Effort:** [Quick/Medium/Substantial]\n\n[Repeat for each urgent issue, or \"None - all issues can wait\" if none urgent]\n\n---\n\n## Natural Fit for Upcoming Work\n\n### ISS-XXX: [description]\n**Fits with:** Phase [X] - [phase name]\n**Reason:** [Same files, same subsystem, natural inclusion]\n\n[Repeat for each, or \"None\" if no natural fits]\n\n---\n\n## Can Wait (no change)\n\n### ISS-XXX: [description]\n**Status:** Still valid, not urgent, keep deferred\n\n[Repeat for each, or list ISS numbers if many]\n```\n</step>\n\n<step name=\"offer_actions\">\n**Offer batch actions:**\n\nBased on analysis, present options:\n\n```\n## Actions\n\nWhat would you like to do?\n```\n\nUse AskUserQuestion with appropriate options based on findings:\n\n**If resolved issues exist:**\n- \"Close resolved issues\" - Move to Closed Enhancements section\n- \"Review each first\" - Show details before closing\n\n**If urgent issues exist:**\n- \"Insert urgent phase\" - Create phase to address urgent issues (/gsd:insert-phase)\n- \"Add to current plan\" - Include in next plan being created\n- \"Defer anyway\" - Keep as-is despite urgency\n\n**If natural fits exist:**\n- \"Note for phase planning\" - Will be picked up during /gsd:plan-phase\n- \"Add explicit reminder\" - Update issue with \"Include in Phase X\"\n\n**Always include:**\n- \"Done for now\" - Exit without changes\n</step>\n\n<step name=\"execute_actions\">\n**Execute selected actions:**\n\n**If closing resolved issues:**\n1. Read current ISSUES.md\n2. For each resolved issue:\n   - Remove from \"## Open Enhancements\"\n   - Add to \"## Closed Enhancements\" with resolution note:\n     ```\n     ### ISS-XXX: [description]\n     **Resolved:** [date] - [reason]\n     ```\n3. Write updated ISSUES.md\n4. Update STATE.md deferred issues count\n\n**If inserting urgent phase:**\n- Display the command for user to run after clearing: `/gsd:insert-phase [after-phase] Address urgent issues ISS-XXX, ISS-YYY`\n\n**If noting for phase planning:**\n- Update issue's \"Suggested phase\" field with specific phase number\n- These will be picked up by /gsd:plan-phase workflow\n</step>\n\n</process>\n\n<success_criteria>\n- [ ] All open issues analyzed against current codebase\n- [ ] Each issue categorized (resolved/urgent/natural-fit/can-wait)\n- [ ] Clear reasoning provided for each categorization\n- [ ] Actions offered based on findings\n- [ ] ISSUES.md updated if user takes action\n- [ ] STATE.md updated if issue count changes\n</success_criteria>"
