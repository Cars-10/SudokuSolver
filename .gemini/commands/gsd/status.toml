description = "Check status of background agents from parallel execution"
prompt = "<objective>\nMonitor background agent status from /gsd:execute-phase parallel execution.\n\nShows running/completed agents from agent-history.json.\nUses TaskOutput to check status of background tasks.\nWith --wait flag, blocks until all agents complete.\n</objective>\n\n<context>\nArguments: $ARGUMENTS\n</context>\n\n<process>\n\n<step name=\"load_history\">\n**Load agent history:**\n\n```bash\ncat .planning/agent-history.json 2>/dev/null || echo '{\"entries\":[]}'\n```\n\nIf file doesn't exist or has no entries:\n```\nNo background agents tracked.\n\nRun /gsd:execute-phase to spawn parallel agents.\n```\nExit.\n</step>\n\n<step name=\"filter_agents\">\n**Find background agents:**\n\nFilter entries where:\n- `execution_mode` is \"parallel\" or \"background\"\n- `status` is \"spawned\" (still running) or recently completed\n\nGroup by `parallel_group` if present.\n</step>\n\n<step name=\"check_running\">\n**Check status of running agents:**\n\nFor each agent with `status === \"spawned\"`:\n\nUse TaskOutput tool:\n```\ntask_id: [agent_id]\nblock: false\ntimeout: 1000\n```\n\n**If TaskOutput returns completed result:**\n- Update agent-history.json: status → \"completed\"\n- Set completion_timestamp\n- Parse files_modified from output if present\n\n**If TaskOutput returns \"still running\":**\n- Keep as spawned (running)\n\n**If TaskOutput returns error:**\n- Update agent-history.json: status → \"failed\"\n</step>\n\n<step name=\"display\">\n**Show status table:**\n\n```\nBackground Agents\n════════════════════════════════════════\n\n| Plan   | Status      | Elapsed  | Agent ID      |\n|--------|-------------|----------|---------------|\n| 10-01  | ✓ Complete  | 2m 15s   | agent_01H...  |\n| 10-02  | ⏳ Running   | 1m 30s   | agent_01H...  |\n| 10-04  | ✓ Complete  | 1m 45s   | agent_01H...  |\n\nProgress: 2/3 complete\n\n════════════════════════════════════════\nWait for all: /gsd:status --wait\n```\n\n**Status icons:**\n- ✓ Complete\n- ⏳ Running\n- ✗ Failed\n- ⏸ Queued (waiting for dependency)\n</step>\n\n<step name=\"wait_mode\">\n**If --wait flag provided:**\n\nFor each agent with status \"spawned\":\n\nUse TaskOutput with blocking:\n```\ntask_id: [agent_id]\nblock: true\ntimeout: 600000\n```\n\nReport as each completes:\n```\n⏳ Waiting for 3 agents...\n\n✓ [1/3] 10-01 complete (2m 15s)\n✓ [2/3] 10-04 complete (1m 45s)\n✓ [3/3] 10-02 complete (3m 30s)\n\n════════════════════════════════════════\nAll agents complete!\n\nTotal time: 3m 30s (parallel)\nSequential estimate: 7m 30s\nTime saved: ~4m (53%)\n════════════════════════════════════════\n```\n\nUpdate agent-history.json with completion status for each.\n</step>\n\n<step name=\"next_steps\">\n**After all complete (or if already complete):**\n\n```\n---\n\n## ▶ Next Up\n\nAll parallel agents finished. Review results:\n\n`/gsd:progress`\n\n<sub>`/clear` first → fresh context window</sub>\n\n---\n```\n</step>\n\n</process>\n\n<success_criteria>\n- [ ] Reads agent-history.json for background agents\n- [ ] Uses TaskOutput to check running agent status\n- [ ] Updates history with current status\n- [ ] Shows simple status table\n- [ ] --wait flag blocks until all complete\n- [ ] Reports time savings vs sequential\n</success_criteria>"
