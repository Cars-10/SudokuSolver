<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>System Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #0d0d12;
            color: #e0e0e0;
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 40px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            animation: fadeIn 1s ease-out;
        }

        .logo {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid #00ff9d;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        h1 {
            color: #00ff9d;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin: 0;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.3);
        }

        .diagram-container {
            width: 100%;
            max-width: 1400px;
            background: #16161e;
            padding: 40px;
            border-radius: 16px;
            border: 1px solid #2a2a35;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
            animation: slideUp 1s ease-out;
            overflow: auto;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Mermaid Overrides */
        .node rect,
        .node circle,
        .node ellipse,
        .node polygon,
        .node path {
            fill: #1a1a2a !important;
            stroke: #00b8ff !important;
            stroke-width: 2px !important;
        }

        .node .label {
            color: #e0e0e0 !important;
            font-family: 'JetBrains Mono', monospace !important;
        }

        .edgePath .path {
            stroke: #5c5c66 !important;
            stroke-width: 2px !important;
        }

        .cluster rect {
            fill: rgba(255, 255, 255, 0.02) !important;
            stroke: #2a2a35 !important;
        }

        .cluster .label {
            color: #00ff9d !important;
        }
    </style>
</head>

<body>
    <div class="header">
        <img src="architecture_logo.png" alt="System Logo" class="logo">
        <h1>System Architecture</h1>
    </div>

    <div class="diagram-container">
        <div class="mermaid">
            graph TB
            %% Definitions
            subgraph Frontend["üñ•Ô∏è Frontend (Browser)"]
            direction TB
            HTML["index.html<br>(Generated Report)"]

            subgraph Scripts["Client Logic (report_client.js)"]
            UI_Logic["UI Controller<br>(Search, Sort, Filter)"]
            Chart_Logic["D3.js Visualizer<br>(Line, Race, Jockey Charts)"]
            API_Client["API Connector<br>(fetch)"]
            Modal_Handler["Modal Manager<br>(Edit/Lock/Upload)"]
            end

            HTML --> UI_Logic
            UI_Logic --> Chart_Logic
            UI_Logic --> Modal_Handler
            Modal_Handler --> API_Client
            Chart_Logic --> API_Client
            end

            subgraph Backend["‚öôÔ∏è Backend (Node.js :9102)"]
            direction TB
            Server["Express Server<br>(server.js)"]

            subgraph Endpoints["API Endpoints"]
            EP_Meta["GET/POST /api/metadata"]
            EP_Lock["POST /api/lock"]
            EP_Run["POST /api/run"]
            EP_Upload["POST /api/upload-media"]
            EP_Static["GET Static Assets"]
            end

            subgraph Execution["Executor Engine"]
            Detect["Docker vs Local Detection"]
            Runner_Docker["Docker Runner<br>(docker run ...)"]
            Runner_Local["Shell Runner<br>(/bin/bash runMeGlobal.sh)"]
            end

            Server --> Endpoints
            EP_Run --> Detect
            Detect -- "If Dockerfile exists" --> Runner_Docker
            Detect -- "Else" --> Runner_Local
            end

            subgraph Storage["üìÅ File System (CleanedUp/)"]
            subgraph Data["Data & Config"]
            MetaFiles["metadata.json"]
            Media["Media/ (Images)"]
            Logs["Logs/ & Metrics"]
            end

            subgraph Solvers["Language Solvers"]
            Code["Source Code"]
            Scripts_SH["setupAndRunMe.sh"]
            Dockerfiles["Dockerfiles"]
            end
            end

            %% Interactions
            API_Client -- "JSON Data" --> EP_Meta
            API_Client -- "Command" --> EP_Run
            API_Client -- "File Upload" --> EP_Upload

            EP_Static -.-> HTML
            EP_Static -.-> Media

            EP_Meta --> MetaFiles
            EP_Lock --> MetaFiles
            EP_Upload --> Media

            Runner_Docker --> Dockerfiles
            Runner_Local --> Scripts_SH
            Runner_Local --> Code

            %% Styling
            classDef plain fill:#fff,stroke:#333,stroke-width:1px,color:#000;
            classDef front fill:#1a1a2a,stroke:#00d9f9,stroke-width:2px,color:#fff;
            classDef back fill:#1a1a2a,stroke:#00ff9d,stroke-width:2px,color:#fff;
            classDef file fill:#1a1a2a,stroke:#ffcc00,stroke-width:2px,color:#fff;

            class HTML,UI_Logic,Chart_Logic,API_Client,Modal_Handler front;
            class Server,EP_Meta,EP_Lock,EP_Run,EP_Upload,EP_Static,Detect,Runner_Docker,Runner_Local back;
            class MetaFiles,Media,Logs,Code,Scripts_SH,Dockerfiles,Data,Solvers file;
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            fontFamily: 'JetBrains Mono',
            themeVariables: {
                darkMode: true,
                background: '#16161e',
                primaryColor: '#1a1a2a',
                primaryTextColor: '#e0e0e0',
                primaryBorderColor: '#00ff9d',
                lineColor: '#5c5c66',
                secondaryColor: '#1a1a2a',
                tertiaryColor: '#16161e'
            }
        });
    </script>
</body>

</html>