# Ralph Progress Log
Started: Fri Jan 10 2026

## Codebase Patterns
- Use `normalizeLanguageName(lang)` to convert display names (F#, C#) to directory format (F_Sharp, C_Sharp)
- Language names should be stored internally in directory format; display conversion happens at render time in HTMLGenerator.ts
- Use `check_toolchain <toolname>` in compile() to gracefully report env_error when toolchain missing
- runMe.sh scripts should source ../common.sh and define LANGUAGE, SOLVER_BINARY, METRICS_FILE, TIMEOUT_SECONDS
- README.md should document package requirements with apt install commands
- Test with matrix 1 first (656 iterations is the expected count)
- Always add `cd "$(dirname "$0")"` at the start of runMe.sh
- metrics.json results array is NOT index-aligned; use `m.results.find()` with `normalizeMatrix()` to look up by matrix number
- runType values: 'Local', 'Docker', 'AI', 'automated', or undefined - icons should only show for explicit values

---

## 2026-01-09 06:50 - US-001 (Ada)
- Verified Ada implementation was already properly configured
- gnatmake exists in Docker at /usr/bin/gnatmake
- runMe.sh already has proper structure
- README.md already documents gnat requirement
- Tested: 656 iterations (correct)

---

## 2026-01-09 - US-002 (Assembly)
- Both x86_64 (Sudoku.asm/NASM) and ARM64 (Sudoku_arm64.s/GCC) variants already exist
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS
- Updated README.md with requirements section
- Tested on ARM64: 656 iterations (correct)

---

## 2026-01-09 - US-003 (BASIC)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, simplified compile()
- Created README.md documenting FreeBASIC (fbc) requirement
- fbc installed in Docker at /usr/local/bin/fbc
- Tested: 656 iterations (correct)

---

## 2026-01-09 - US-004 (Crystal)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, proper compile()
- Crystal not installed in Docker - properly reports env_error
- README.md already exists

---

## 2026-01-09 - US-005 (C#)
- Root cause: Sudoku.csproj targeted net9.0 but Docker has .NET 8.0 SDK
- Fixed by changing TargetFramework from net9.0 to net8.0
- Build now succeeds
- runMe.sh was already properly configured

---

## 2026-01-09 - US-006 (Fish)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, simplified to use check_toolchain
- Created README.md documenting fish requirement
- fish installed in Docker at /usr/bin/fish
- Runs successfully

---

## 2026-01-09 - US-007 (Jupyter)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, simplified compile()
- Created README.md documenting jupyter/nbconvert requirement
- jupyter installed in Docker at /usr/local/bin/jupyter
- Tested: 656 iterations (correct)

---

## 2026-01-09 - US-008 (Ksh)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, use check_toolchain
- Created README.md documenting ksh requirement
- ksh installed in Docker at /usr/bin/ksh
- Runs successfully

---

## 2026-01-09 - US-009 (Objective-C)
- GNUstep is installed in Docker
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, better error handling for GNUstep
- Created README.md documenting requirements for macOS and Linux
- Tested: 445778 iterations on matrix 5 (correct)

---

## 2026-01-09 - US-010 (Smalltalk)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, use check_toolchain
- Created README.md documenting gnu-smalltalk (gst) requirement
- gst not installed in Docker - properly reports env_error

---

## 2026-01-09 - US-011 (Vimscript)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, use check_toolchain
- Created README.md documenting vim requirement
- vim installed in Docker at /usr/bin/vim
- Runs successfully

---

## 2026-01-09 - US-012 (XSLT)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, use check_toolchain
- Created README.md documenting xsltproc requirement
- xsltproc installed in Docker at /usr/bin/xsltproc
- Runs successfully

---

## 2026-01-09 - US-013 (Zsh)
- Fixed runMe.sh: added cd, METRICS_FILE, TIMEOUT_SECONDS, use check_toolchain
- Created README.md documenting zsh requirement
- zsh installed in Docker at /usr/bin/zsh
- Runs successfully

---

## Summary (Previous PRD - fix-env-errors)
All 13 user stories completed:
- 11 languages now run successfully in Docker
- 2 languages (Crystal, Smalltalk) properly report env_error (toolchain not installed)
- All runMe.sh scripts follow consistent pattern
- All languages have README.md with requirements documented

---

## 2026-01-10 - US-001 (Fix F# duplicate entry)
- Identified source: session_state.json had both "F_Sharp" and "F#" in selected array
- Added `normalizeLanguageName()` helper in Metrics/report_client.js
- Applied normalization in: loadSessionState, toggleLock, selectAllLangs, updateLangSelection
- Cleaned up session_state.json to remove duplicate "C#" and "F#" entries
- Display conversion still happens at render time in HTMLGenerator.ts (line 1631)
- **Learnings for future iterations:**
  - Language names must be stored in directory format (F_Sharp, C_Sharp) everywhere except display
  - report_client.js handles client-side state; HTMLGenerator.ts handles server-side render
---

## 2026-01-10 - US-002 (Fix C language missing run buttons)
- Root cause: HTMLGenerator.ts was hiding run buttons for "locked" languages
- The isLocked check was based on session_state.json locked array
- But "locked" should only affect bulk operations, not hide individual run buttons
- Fixed by removing the `!isLocked` conditional from run button rendering
- Files changed: Metrics/HTMLGenerator.ts
- Verified: C language now shows all 6 matrix run buttons + Run All button
- **Learnings for future iterations:**
  - "Locked" languages = protected from bulk actions, NOT from individual runs
  - Run buttons should always be visible for all cells with data
---

## 2026-01-10 - US-003 (Fix empty cells for Ada, CoffeeScript, and similar languages)
- Root cause: Matrix cell loop used `m.results[i]` assuming results are index-aligned
- Actual format: results array may have gaps (e.g., only matrix 1 result, or env_error with "N/A")
- Fix: Use `m.results.find()` by matrix number instead of array index
- Empty cells now render full cell structure with run button and dash placeholders
- Files changed: Metrics/HTMLGenerator.ts (lines 1729-1781)
- Verified: AppleScript (env_error), Crystal (partial results) both show run buttons
- **Learnings for future iterations:**
  - metrics.json results array is NOT index-aligned with matrix numbers
  - Always use `normalizeMatrix()` to find results by matrix number
  - Empty cells should still have full UI structure for consistency
---

## 2026-01-10 - US-004 (Show computer icon only for explicit Local runs)
- Root cause: HTMLGenerator.ts had `const runType = m.runType || 'Local'` defaulting undefined to 'Local'
- Also: generate_report_only.ts set `runType: 'Local'` for placeholder entries (missing languages)
- Fix 1: Changed HTMLGenerator.ts to use `const runType = m.runType` (no fallback)
- Fix 2: Changed icon logic from else-fallback to explicit `runType === 'Local'` check
- Fix 3: Removed runType assignment for placeholder entries in generate_report_only.ts
- Files changed: Metrics/HTMLGenerator.ts, Metrics/generate_report_only.ts
- Result: Computer icon only appears when runType is explicitly 'Local', not for missing data
- **Learnings for future iterations:**
  - runType values are: 'Local', 'Docker', 'AI', 'automated', or undefined
  - Icons should only show for explicit values, not as defaults
  - Placeholder entries (orderedLanguages not found in metrics) shouldn't have runType
---

## 2026-01-10 - US-005 (Create Score Modal component)
- Created new Score Modal with purple/violet accent (#bb9af7) to distinguish from language modal (#7aa2f7)
- Added Score Modal HTML in HTMLGenerator.ts after Why Modal
- Added CSS styles for scoreModal including tier-badge-large, score-value, score-breakdown
- Added showScoreDetails() and closeScoreModal() functions in report_client.js
- Added click handler for .score-col cells on DOMContentLoaded
- Modal shows: tier badge, composite score (Ψ), individual ratio breakdown (time, mem, CPU, iter)
- Files changed: Metrics/HTMLGenerator.ts, Metrics/report_client.js
- **Learnings for future iterations:**
  - Modal components follow pattern: CSS styles -> HTML element -> JS functions
  - Use distinct accent colors to differentiate related modals
  - Score breakdown data comes from row data-score-breakdown attribute
  - Tier class mapping: tier-s, tier-a, tier-b, tier-c, tier-d, tier-f
---

## 2026-01-10 - US-006 (Move Performance Profile radar chart to Score Modal)
- Added Performance Profile radar chart section to Score Modal in HTMLGenerator.ts
- Implemented drawScoreRadarChart() function in report_client.js using D3.js
- Radar chart shows 4 metrics: Speed (time ratio), Memory, CPU, Iterations
- C baseline shown as blue polygon at 1.0 on all axes
- Language performance shown as purple overlay polygon
- Auto-scales based on ratio values (minimum 3x, extends if ratios are higher)
- Grid lines at 0.5x intervals with special emphasis on 1.0x (C baseline)
- Interactive tooltips show exact values for both language and C baseline on hover
- Added legend distinguishing "Language" vs "C Baseline (1.0)"
- Files changed: Metrics/HTMLGenerator.ts, Metrics/report_client.js
- **Learnings for future iterations:**
  - D3.js radar charts use polar coordinates with angleSlice = 2π / numAxes
  - For ratio display (where 1.0 = baseline), linear scale works better than log
  - Polygon points calculated as: x = centerX + r * cos(angle - π/2), y = centerY + r * sin(angle - π/2)
  - Tooltips in D3: use d3.select('body').selectAll('.tooltip').data([null]).enter() pattern
  - showScoreDetails() already had ratio parsing logic - extend it to call radar chart
---

## 2026-01-10 - US-007 (Move Matrix Results to Score Modal)
- Added Matrix Results section to Score Modal with C baseline comparison
- Matrix table shows all 5 matrices: Language time | C time | Ratio
- Color-coded ratios: green (#9ece6a) for faster, red (#f7768e) for slower, purple (#bb9af7) for baseline
- Each row has expandable details showing: memory, iterations, CPU user/sys, page faults, context switches
- Added CSS styles for matrix-results-section, matrix-results-table, ratio coloring, expandable details
- Added populateMatrixResults() function to populate matrix data from metricsData
- Added toggleMatrixDetails() function for expanding/collapsing row details
- Removed Matrix Results section from language modal expanded-content rows
- Files changed: Metrics/HTMLGenerator.ts, Metrics/report_client.js
- **Learnings for future iterations:**
  - Score Modal now contains: tier badge, score breakdown, radar chart, AND matrix results
  - Language modal expanded content only has System and Compilation sections now
  - Matrix results use metricsData which is injected as JSON in the HTML
  - C baseline data accessed via metricsData.find(m => m.solver === 'C')
---

## 2026-01-10 - US-008 (Auto-refresh cell after benchmark run)
- Added new API endpoints: /api/metrics/:language and /api/metrics/baseline/c
- Endpoints return fresh metrics data for real-time cell updates without page reload
- Updated runSolver() in report_client.js:
  - Shows loading spinner on run button (⟳ with CSS spin animation)
  - Adds cell-loading class to target cells (opacity 0.6, pointer-events none)
  - On success: calls refreshLanguageCells() to update DOM
  - On error: shows cell-error class (red background flash)
  - On success: shows cell-success animation (green flash)
- Added refreshLanguageCells() helper function:
  - Fetches fresh metrics via /api/metrics/:language
  - Fetches C baseline via /api/metrics/baseline/c
  - Updates time, iterations, memory in each matrix cell
  - Updates total time cell
  - Updates row data attributes for sorting
  - Updates "Updated" column to show "Just now"
  - Calls updateLanguageScore() if all 5 matrices complete
- Added updateLanguageScore() helper:
  - Calculates time and memory ratios vs C baseline
  - Computes composite score (60% time + 40% memory)
  - Determines tier (S/A/B/C/D/F)
  - Updates score cell with new values and colors
- Files changed: server/index.js, Metrics/HTMLGenerator.ts, Metrics/report_client.js
- **Learnings for future iterations:**
  - Cell refresh uses CSS classes for state management: cell-loading, cell-error, cell-success
  - Run button text changes to ⟳ during loading (spinning via CSS animation)
  - Score calculation: avgTimeRatio * 0.6 + avgMemRatio * 0.4
  - Tier thresholds: S(≤1.0), A(≤1.5), B(≤3.0), C(≤10.0), D(≤50.0), F(>50.0)
  - Use encodeURIComponent for language names in API URLs
---

## 2026-01-10 - US-009 (Update language modal without performance sections)
- Verified language modal structure:
  - Performance Profile was NEVER in language modal (added fresh to Score Modal in US-006)
  - Matrix Results were in expanded-content rows (removed in US-007)
  - Language modal correctly contains: Description, Creators & Authors, Edit functionality, logo management
- Added "View Performance" button in modal-header-buttons area
- Button styled with purple accent (#bb9af7) to match Score Modal
- Added openScoreModalFromLangModal() function in report_client.js
- Function closes language modal, then opens Score Modal for the current language
- Files changed: Metrics/HTMLGenerator.ts, Metrics/report_client.js
- **Learnings for future iterations:**
  - Language modal is for info/editing (description, creators, authors, logo)
  - Score Modal is for performance data (radar chart, matrix results, tier badge)
  - currentEditingLang variable tracks which language the modal is showing
  - Modals can be chained by closing one and opening another with a short delay
---
