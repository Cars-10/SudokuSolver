---
phase: 20-algorithm-aware-ui-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [Metrics/report_client.js]
autonomous: true
---

<objective>
Add algorithm filtering to line chart and jockey chart for consistent multi-algorithm experience.

Purpose: Ensure all D3.js performance charts respect the selected algorithm filter, providing accurate visualizations that match the main table filtering.
Output: Two charts with algorithm-aware filtering matching existing patterns from language performance and iteration count charts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-language-metadata-and-display-fixes/19-02-SUMMARY.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

**Current state:**
- window.currentAlgorithm is initialized to 'BruteForce' (HTMLGenerator.ts:1615)
- filterByAlgorithm() updates window.currentAlgorithm when user changes selection
- Two charts already have algorithm filtering: drawLanguagePerformanceChart (line 3011) and drawIterationCountChart (line 3343)
- Two charts need algorithm filtering: drawLineChart (line 2439) and drawJockeyChart (line 2641)

**Existing pattern (from drawLanguagePerformanceChart):**
```javascript
const selectedAlgo = window.currentAlgorithm || 'BruteForce';
const algoLabel = {
    'BruteForce': 'Brute Force',
    'DLX': 'Dancing Links',
    'CP': 'Constraint Propagation',
    'all': 'All Algorithms'
}[selectedAlgo] || 'BruteForce';

const filtered = metricsData.filter(d => {
    const algoType = d.algorithmType || 'BruteForce';
    if (selectedAlgo === 'all') return true;
    return algoType === selectedAlgo;
});
```

@Metrics/report_client.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add algorithm filtering to drawLineChart</name>
  <files>Metrics/report_client.js</files>
  <action>
Add algorithm filtering to drawLineChart() function (around line 2439):

1. After line 2442, add algorithm filter logic:
   - Get selectedAlgo from window.currentAlgorithm (default 'BruteForce')
   - Create algoLabel map (same as existing charts)
   - Filter `data` array by algorithmType matching selectedAlgo
   - If selectedAlgo === 'all', include all data
   - Store filtered data in new variable (e.g., `filteredData`)

2. Replace all references to `data` in the function with `filteredData`

3. Update chart title to include algorithm context:
   - Find where title is set (likely "Performance Over Matrices" or similar)
   - Change to: `Performance: ${algoLabel}` or `${algoLabel} - Performance Over Matrices`

4. For "All Algorithms" mode, add algorithm suffix to solver names:
   - When selectedAlgo === 'all', append ' (BF)', ' (DLX)', or ' (CP)' to solver names
   - Follow same pattern as drawLanguagePerformanceChart line 3047-3053

Do NOT add empty data checks - the function should gracefully handle empty arrays. Do NOT modify chart dimensions or styling.
  </action>
  <verify>
1. npx tsc --noEmit (TypeScript compilation passes - report_client.js is JS but project has TS)
2. cd Metrics && npx ts-node generate_report_only.ts (report generates without errors)
3. Grep for selectedAlgo usage: grep -n "selectedAlgo.*currentAlgorithm" Metrics/report_client.js
4. Verify filteredData replaces data: grep -A 5 "function drawLineChart" Metrics/report_client.js | grep -E "(const filtered|selectedAlgo)"
  </verify>
  <done>
- drawLineChart filters data by window.currentAlgorithm
- Chart title includes algorithm label
- "All Algorithms" mode shows algorithm suffixes on solver names
- No TypeScript errors
- Report generates successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Add algorithm filtering to drawJockeyChart</name>
  <files>Metrics/report_client.js</files>
  <action>
Add algorithm filtering to drawJockeyChart() function (around line 2641):

1. After line 2654, add algorithm filter logic:
   - Get selectedAlgo from window.currentAlgorithm (default 'BruteForce')
   - Create algoLabel map (identical to Task 1)
   - Filter `data` array by algorithmType matching selectedAlgo
   - If selectedAlgo === 'all', include all data
   - Store filtered data in variable `filteredData`

2. Replace `data` with `filteredData` in:
   - Line ~2679: `const sortedData = [...data].map` â†’ `const sortedData = [...filteredData].map`
   - Any other references to `data` within this function scope

3. Update chart title or add algorithm context:
   - Find where title/label is set (likely "Jockey Chart" or similar)
   - Change to: `Jockey Chart: ${algoLabel}` or similar

4. For "All Algorithms" mode:
   - When selectedAlgo === 'all', append ' (BF)', ' (DLX)', or ' (CP)' to solver names in Y axis
   - Same pattern as Task 1

Do NOT add empty data checks. Do NOT modify zoom behavior or axis scaling.
  </action>
  <verify>
1. npx tsc --noEmit (passes)
2. Grep verification: grep -A 10 "function drawJockeyChart" Metrics/report_client.js | grep "selectedAlgo\|filteredData"
3. cd Metrics && npx ts-node generate_report_only.ts (succeeds)
4. Check sortedData uses filtered: grep -n "sortedData.*filteredData" Metrics/report_client.js
  </verify>
  <done>
- drawJockeyChart filters data by window.currentAlgorithm
- Chart title includes algorithm label
- "All Algorithms" mode shows algorithm suffixes
- sortedData uses filteredData, not raw data
- No TypeScript errors
- Report generates successfully
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npx tsc --noEmit passes without errors
- [ ] cd Metrics && npx ts-node generate_report_only.ts generates report successfully
- [ ] Both drawLineChart and drawJockeyChart have selectedAlgo and filteredData variables
- [ ] grep "window.currentAlgorithm" Metrics/report_client.js shows 4 chart functions using it (was 2, now 4)
- [ ] No undefined variable errors in report_client.js
</verification>

<success_criteria>

- All tasks completed
- Both charts filter by window.currentAlgorithm
- Chart titles show algorithm context
- "All Algorithms" mode displays algorithm suffixes
- TypeScript compilation passes
- Report generation succeeds
- No regressions in existing chart functions
</success_criteria>

<output>
After completion, create `.planning/phases/20-algorithm-aware-ui-components/20-01-SUMMARY.md`
</output>
