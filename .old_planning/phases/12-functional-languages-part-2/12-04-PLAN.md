---
phase: 12-functional-languages-part-2
plan: 04
type: execute
depends_on: []
files_modified: [Algorithms/DLX/Racket/dlx.rkt, Algorithms/DLX/Racket/runMe.sh, Algorithms/CP/Racket/cp.rkt, Algorithms/CP/Racket/runMe.sh]
---

<objective>
Implement DLX and CP algorithms for Racket, leveraging its Scheme heritage with modern features like structs with mutable fields and vectors.

Purpose: Extend the benchmark suite with Racket implementations demonstrating modern Scheme capabilities for stateful algorithms.
Output: Working DLX and CP Racket implementations with verified iteration counts (DLX: 43, CP: 67).
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

# Phase 11 patterns established - Scheme provides close guidance
@.planning/phases/11-functional-languages-part-1/11-05-SUMMARY.md
@.planning/phases/11-functional-languages-part-1/11-02-SUMMARY.md

# Reference implementations
@Algorithms/BruteForce/Racket/Sudoku.rkt

**Tech stack available**: Racket with modern Scheme features (structs, vectors, parameters)
**Established patterns from Scheme (Phase 11)**:
- DLX uses vectors for node representation (Scheme used vectors with circular links)
- CP uses vectors with bitsets for candidates
- Target iteration counts: DLX=43, CP=67 (CP may vary to 77-84)
- Racket has struct with #:mutable for cleaner syntax than vector-set!

**Key decisions from Phase 11 Scheme**:
- Vector-based structures avoid deprecated set-car!/set-cdr!
- Racket's (struct node ([field #:mutable] ...) #:transparent) is cleaner than raw vectors
- Use vector-ref/vector-set! or struct accessors for mutations
- Matrix 1 verification is mandatory
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement DLX algorithm in Racket</name>
  <files>Algorithms/DLX/Racket/dlx.rkt, Algorithms/DLX/Racket/runMe.sh</files>
  <action>Create dlx.rkt implementing Dancing Links using Racket structs. Structure:
  - Use #lang racket with #!/usr/bin/env racket shebang
  - (struct node ([left #:mutable] [right #:mutable] [up #:mutable] [down #:mutable] [column #:mutable] [size #:mutable] [row-id #:mutable] [col-id #:mutable]) #:transparent)
  - OR use vectors like Phase 11 Scheme: (make-vector 8) with indices [left right up down column size row-id col-id]
  - Initialize 324-column exact cover matrix (9×9×4 constraints)
  - Store nodes in vector or hash by integer ID
  - Use (set-node-left! ...) or (vector-set! ...) for pointer updates
  - Implement cover/uncover operations
  - Column selection heuristic: minimum size
  - Pre-cover given clues before search
  - Search with backtracking
  - Parse Matrix 1 format and output solved board
  - Track iteration counter (define iterations (make-parameter 0))
  - Should reach exactly 43 iterations for Matrix 1

  Create runMe.sh following Phase 11 pattern:
  - Set LANGUAGE="Racket", ALGORITHM="DLX"
  - SOLVER_BINARY="racket dlx.rkt", METRICS_FILE="metrics.json"
  - Source ../../common.sh
  - compile() checks for racket in PATH
  - Call main "$@"

  Avoid: Immutable recursion with deep copying, non-tail-recursive search causing stack overflow, using deprecated set-car!/set-cdr!.</action>
  <verify>./runMe.sh ../../Matrices/1.matrix outputs "Solved in Iterations=43" and correct solution</verify>
  <done>DLX Racket passes Matrix 1 with exactly 43 iterations, runMe.sh functional</done>
</task>

<task type="auto">
  <name>Task 2: Implement CP algorithm in Racket</name>
  <files>Algorithms/CP/Racket/cp.rkt, Algorithms/CP/Racket/runMe.sh</files>
  <action>Create cp.rkt implementing Constraint Propagation using Racket vectors. Structure:
  - Use #lang racket with #!/usr/bin/env racket shebang
  - Grid: (make-vector 81 0) for flattened 9×9, or nested vectors
  - Candidates: (make-vector 81 #b1111111110) for bitsets
  - Bitset operations: (bitwise-and), (bitwise-ior), (bitwise-not), (arithmetic-shift) for masking
  - Initialize: empty cells get candidates = #b1111111110 (bits 1-9)
  - assign(row, col, digit): (vector-set! grid idx digit), propagate constraints
  - eliminate(row, col, digit): mask out digit bit, check singleton/contradiction
  - Propagate strategies: singleton elimination, hidden singles
  - Search with MRV heuristic: find cell with minimum (popcount candidates)
  - Backtracking: save/restore vectors with (vector-copy)
  - Track iteration counter (define iterations (make-parameter 0)) in assign
  - Expect 67 iterations (may vary to ~77-84 like Scheme in Phase 11)

  Create runMe.sh following Phase 11 pattern:
  - Set LANGUAGE="Racket", ALGORITHM="CP"
  - SOLVER_BINARY="racket cp.rkt", METRICS_FILE="metrics.json"
  - Source ../../common.sh
  - compile() checks for racket in PATH
  - Call main "$@"

  Avoid: Stack overflow from non-tail recursion, excessive vector copying, using lists for arrays (slow random access).</action>
  <verify>./runMe.sh ../../Matrices/1.matrix outputs "Solved in Iterations=67" (or 77-84 acceptable) with correct solution</verify>
  <done>CP Racket passes Matrix 1 with correct solution and iteration count in acceptable range, runMe.sh functional</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both DLX and CP implementations exist
- [ ] DLX achieves exactly 43 iterations on Matrix 1
- [ ] CP achieves 67 iterations (or 77-84 range acceptable) on Matrix 1
- [ ] Both produce correct solutions matching C reference
- [ ] Both runMe.sh scripts work with common.sh integration
- [ ] metrics.json files generated successfully
</verification>

<success_criteria>

- DLX Racket implementation complete with verified iteration count (43)
- CP Racket implementation complete with verified iteration count (67 or acceptable range)
- Both algorithms produce correct solutions
- No compilation errors or runtime crashes
- Integration with benchmark suite successful
</success_criteria>

<output>
After completion, create `.planning/phases/12-functional-languages-part-2/12-04-SUMMARY.md`:

# Phase 12 Plan 4: Racket Algorithms Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [DLX/CP implementation details]
- [Struct vs vector approach used]
- [Iteration counts achieved]

## Files Created/Modified

- `Algorithms/DLX/Racket/dlx.rkt` - Description
- `Algorithms/DLX/Racket/runMe.sh` - Description
- `Algorithms/CP/Racket/cp.rkt` - Description
- `Algorithms/CP/Racket/runMe.sh` - Description

## Decisions Made

[Key technical decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for parallel execution with other Phase 12 plans.
</output>
