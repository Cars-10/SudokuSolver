---
phase: 25-cp-lisp-reverts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Algorithms/CP/CommonLisp/cp.lisp
  - Algorithms/CP/EmacsLisp/cp.el
  - Algorithms/CP/Scheme/cp.scm
  - Algorithms/CP/CommonLisp/metrics.json
  - Algorithms/CP/EmacsLisp/metrics.json
  - Algorithms/CP/Scheme/metrics.json
autonomous: true
---

<objective>
Revert broken Lisp family CP implementations to their original working state.

Purpose: The failed fix attempt in commit d5a4b52 broke CommonLisp, EmacsLisp, and Scheme CP implementations. They now produce 0 iterations and error status instead of working solutions with 84 iterations. Restoring them to original state recovers working implementations.

Output: Three working CP implementations that produce correct Sudoku solutions with 84 iterations (vs target 67, but acceptable per pragmatic validation policy).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Relevant prior work
@.planning/phases/18-validation-and-integration/FINAL-VALIDATION-REPORT.md

# Git history for reverts
# CommonLisp original: commit a6e8daa (feat(12-03): implement CP algorithm in Common Lisp)
# EmacsLisp original: commit ef88058 (feat(12-05): implement CP algorithm in Emacs Lisp)
# Scheme original: commit 90f9184 (feat(11-05): implement CP algorithm in Scheme)
# Broken fix: commit d5a4b52 (fix(18-03): attempt to fix Lisp family CP iteration counts)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Revert CommonLisp CP to original working state</name>
  <files>Algorithms/CP/CommonLisp/cp.lisp</files>
  <action>
    Use git to restore the file from commit a6e8daa:
    ```
    git show a6e8daa:Algorithms/CP/CommonLisp/cp.lisp > Algorithms/CP/CommonLisp/cp.lisp
    ```

    This restores the original implementation that:
    - Uses hidden singles propagation strategy
    - Correctly counts 84 iterations for Matrix 1
    - Produces valid Sudoku solutions

    Do NOT attempt to fix the iteration count - 84 iterations with correct solutions is acceptable per pragmatic validation policy.
  </action>
  <verify>
    Run the solver on Matrix 1 using Docker (has sbcl pre-installed):
    ```
    docker-compose exec app bash -c "cd /app/Algorithms/CP/CommonLisp && ./runMe.sh ../../Matrices/1.matrix"
    ```
    If Docker unavailable, try locally: `cd Algorithms/CP/CommonLisp && ./runMe.sh ../../Matrices/1.matrix`
    Confirm output shows "Solved in Iterations=84" and valid solution grid.
  </verify>
  <done>CommonLisp CP solver produces 84 iterations with valid solution (previously 0 with error)</done>
</task>

<task type="auto">
  <name>Task 2: Revert EmacsLisp CP to original working state</name>
  <files>Algorithms/CP/EmacsLisp/cp.el</files>
  <action>
    Use git to restore the file from commit ef88058:
    ```
    git show ef88058:Algorithms/CP/EmacsLisp/cp.el > Algorithms/CP/EmacsLisp/cp.el
    ```

    This restores the original implementation that:
    - Uses Emacs Lisp vectors and bitset operations
    - Uses MRV heuristic for search with backtracking
    - Correctly counts 84 iterations for Matrix 1

    Do NOT attempt to fix the iteration count - 84 iterations with correct solutions is acceptable.
  </action>
  <verify>
    Run the solver on Matrix 1 using Docker (has emacs pre-installed):
    ```
    docker-compose exec app bash -c "cd /app/Algorithms/CP/EmacsLisp && ./runMe.sh ../../Matrices/1.matrix"
    ```
    If Docker unavailable, try locally: `cd Algorithms/CP/EmacsLisp && ./runMe.sh ../../Matrices/1.matrix`
    Confirm output shows "Solved in Iterations=84" and valid solution grid.
  </verify>
  <done>EmacsLisp CP solver produces 84 iterations with valid solution (previously env_error)</done>
</task>

<task type="auto">
  <name>Task 3: Revert Scheme CP to original working state</name>
  <files>Algorithms/CP/Scheme/cp.scm</files>
  <action>
    Use git to restore the file from commit 90f9184:
    ```
    git show 90f9184:Algorithms/CP/Scheme/cp.scm > Algorithms/CP/Scheme/cp.scm
    ```

    This restores the original implementation that:
    - Uses GNU Guile with vectors for grid representation
    - Uses bitsets for candidate tracking
    - Correctly counts 84 iterations for Matrix 1

    Do NOT attempt to fix the iteration count - 84 iterations with correct solutions is acceptable.
  </action>
  <verify>
    Run the solver on Matrix 1 using Docker (has guile pre-installed):
    ```
    docker-compose exec app bash -c "cd /app/Algorithms/CP/Scheme && ./runMe.sh ../../Matrices/1.matrix"
    ```
    If Docker unavailable, try locally: `cd Algorithms/CP/Scheme && ./runMe.sh ../../Matrices/1.matrix`
    Confirm output shows "Solved in Iterations=84" and valid solution grid.
  </verify>
  <done>Scheme CP solver produces 84 iterations with valid solution (previously 0 with error)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three solvers run without errors
- [ ] All three solvers produce 84 iterations for Matrix 1
- [ ] All three solvers produce valid Sudoku solutions
- [ ] Git shows clean reverts (no uncommitted changes to other files)
</verification>

<success_criteria>

- All tasks completed
- CommonLisp CP: 84 iterations, valid solution
- EmacsLisp CP: 84 iterations, valid solution
- Scheme CP: 84 iterations, valid solution
- No new errors introduced
- Commit created documenting the reverts
</success_criteria>

<output>
After completion, create `.planning/phases/25-cp-lisp-reverts/25-01-SUMMARY.md`
</output>
